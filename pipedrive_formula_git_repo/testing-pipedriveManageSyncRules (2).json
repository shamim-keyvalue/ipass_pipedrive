{"id":29426,"name":"testing-pipedriveManageSyncRules","userId":27893,"accountId":24428,"createdDate":"2019-09-05T07:12:42Z","steps":[{"id":216405,"onSuccess":["checkExecutionStatus_getNewAccessToken"],"onFailure":[],"name":"accessTokenFormulaDetails","type":"script","properties":{"body":"let formulaExecutionDetails;\n\nif(steps.getNewAccessToken !== undefined){\n  formulaExecutionDetails = {\n  \"excecutionId\":steps.getNewAccessToken.response.body[0].id,\n  \"instance\": steps.triggerRefreshToken.instanceId,\n  \"formula\": \"974\"\n  };\n}else{\n  formulaExecutionDetails = {\n    \"excecutionId\":steps.InputParams.params.input.tokenUpdateExecutionId\n  };\n}\n\n\nlet checkStatusParams = {\n  url: \"/formulas/instances/executions/\"+ formulaExecutionDetails.excecutionId\n};\n\ndone({\n  formulaExecutionDetails: formulaExecutionDetails,\n  checkStatusParams: checkStatusParams\n});\n\n"}},{"id":222881,"onSuccess":["loopOverPipelines"],"onFailure":[],"name":"addStagesToList","type":"script","properties":{"body":"let stagesData;\nlet temp;\nlet outputData = [];\n\nif((steps.getStagesFromPipedrive.response.code !== 200) || (steps.getStagesFromPipedrive.response.body.data === undefined) || (steps.getStagesFromPipedrive.response.body.data.length === 0)){\n  \n  if((steps.getStagesFromPipedrive_params.stageList !== undefined) && (steps.getStagesFromPipedrive_params.stageList.length !== 0)){\n      stagesData = steps.getStagesFromPipedrive_params.stageList;\n      done({\n        stages: stagesData\n      });\n  }\n  done(false);\n}\n\n\nstagesData = steps.getStagesFromPipedrive.response.body.data;\n\nfor(var i=0; i < stagesData.length; i++){\n  if(stagesData[i].active_flag === false){\n    continue;\n  }\n  \n temp = {\n    \"value\": stagesData[i].id,\n    \"disp\": stagesData[i].name,\n    \"helptext\": \"Last Created Open deal will be updated in Pipedrive. <a href='' target='blank'>Learn More</a>\" \n   };\n   outputData.push(temp);\n}\n\nif(steps.getStagesFromPipedrive_params.stageList.length !== 0){\n  let stageData = steps.getStagesFromPipedrive_params.stageList;\n  stageData.push(outputData);\n  done({\n    stages: stageData\n  });\n}\n\n\ndone({\n  stages: [outputData]\n});"}},{"id":216406,"onSuccess":["accessTokenFormulaDetails"],"onFailure":["triggerRefreshToken"],"name":"alreadyExecutionExist","type":"filter","properties":{"body":"if(steps.InputParams.params.input.tokenUpdateExecutionId !== null){\n  done(true);\n}\n\ndone(false);"}},{"id":216407,"onSuccess":["executionStatus_getNewAccessToken"],"onFailure":[],"name":"checkExecutionStatus_getNewAccessToken","type":"request","properties":{"api":"${steps.accessTokenFormulaDetails.checkStatusParams.url}","method":"GET"}},{"id":225912,"onSuccess":["isInstanceExist"],"onFailure":[],"name":"checkInstanceExist","type":"script","properties":{"body":"let instances=steps.getInstances.response.body;\nlet siteName= steps.InputParams.params.input.siteName;\nlet bodyParam=steps.formulaInformation;\n\nlet flag = false;\nlet instanceInfo = '';\nlet formulaNames = \"formula_ManageSyncRules_Save\";\n  \nlet instanceNames = bodyParam.formula_ManageSyncRules_Save.name;\n\nlet param=bodyParam.formula_ManageSyncRules_Save;\n\n\nfor(var i=0;i<instances.length;i++){\n  if(instances[i].name === instanceNames){\n    flag = true;\n    instanceInfo =  instances[i];\n    formulaName = formulaNames;\n    break;\n  }\n}\n\nif(flag === false){\n  done({\n    flag: false,\n    formulaName : formulaNames,\n    instanceInfo: param\n  });\n}\n\nif(flag === true){\n  done({\n    flag: true,\n    formulaName : formulaNames,\n    instanceInfo: instanceInfo\n  });\n}\n\n"}},{"id":216408,"onSuccess":["getPipelinesFromPipedrive_params"],"onFailure":[],"name":"ConfigParams","type":"script","properties":{"body":"let tpConfig = null;\n\nif(steps.getTpConfig.response.body.third_party_configuration !== undefined){\n  tpConfig = steps.getTpConfig.response.body;\n}\n\nlet config = {\n  params: steps.InputParams.params.input,\n  pipedriveApiToken: steps.getTpConfig.response.body.third_party_configuration.config_json.cloudElements.OAuth_Parameters.access_token || null\n};\n\nif(steps.updateConfiguration !== undefined){\n  if(steps.updateConfiguration.OAuthData !== null){\n    tpConfig.third_party_configuration.config_json.cloudElements.OAuth_Parameters = steps.updateConfiguration.OAuthData.OAuthDetails;\n  }\n  config.pipedriveApiToken = steps.updateConfiguration.OAuthData.OAuthDetails.access_token;\n}\n\ndone({\n  tpConfig: tpConfig,\n  config: config\n});\n\n"}},{"id":216409,"onSuccess":["getResultAccessToken"],"onFailure":[],"name":"createDelay","type":"httpRequest","properties":{"url":"${steps.delayExecution.payload.url}","headers":"${steps.delayExecution.payload.headers}","method":"GET"}},{"id":225910,"onSuccess":["newInstanceCreatedInfo"],"onFailure":[],"name":"createFormulaInstance","type":"request","properties":{"body":"${steps.createFormulaInstanceParams.createInstanceConfig.body}","api":"${steps.createFormulaInstanceParams.createInstanceConfig.url}","method":"POST"}},{"id":225909,"onSuccess":["createFormulaInstance"],"onFailure":[],"name":"createFormulaInstanceParams","type":"script","properties":{"body":"let formulaId = steps.formulaInformation.formulaId || null;\n\n\nlet createInstanceConfig = {\n  url: \"/formulas/\"+formulaId+\"/instances\",\n  body: steps.checkInstanceExist.instanceInfo\n};\n\n\ndone({\n  createInstanceConfig: createInstanceConfig\n});\n\n\n"}},{"id":216410,"onSuccess":["createDelay"],"onFailure":[],"name":"delayExecution","type":"script","properties":{"body":"let payload = {\n  url: \"https://api.cloud-elements.co.uk/elements/api-v2/createDelay\",\n  headers:{\n    \"authorization\": \"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n    \"Elements-Formula-Instance-Id\": \"961\"\n  }\n};\n\ndone({\n  payload: payload\n});"}},{"id":219871,"onSuccess":["InputParams"],"onFailure":[],"name":"EnvProps","type":"script","properties":{"body":"let cloudElementsUrl = \"https://staging.cloud-elements.com/elements/api-v2\";\nlet getOrganizationSettingsInstance = \"400183\";\n\ndone({\n  cloudElementsUrl: cloudElementsUrl,\n  getOrganizationSettingsInstance: getOrganizationSettingsInstance\n});"}},{"id":222884,"onSuccess":[],"onFailure":[],"name":"Error","type":"script","properties":{"body":"let card = {\n    \"cards\": [{\n        \"id\": \"check2\",\n        \"card\": {\n            \"type\": \"ACTION\",\n            \"heading\": \"Error\",\n            \"listContent\": [\n                \"Error\"\n            ],\n            \"icon\": \"WARNING\"\n          \n        }\n    }]\n}\n\ndone({\n  statusCode: 200,\n  result: card\n})"}},{"id":216411,"onSuccess":["isAccessTokenFormulaDone"],"onFailure":[],"name":"executionStatus_getNewAccessToken","type":"script","properties":{"body":"let executionData = {};\n\nif(steps.checkExecutionStatus_getNewAccessToken.response.body.status === undefined) {\n  executionData.status = \"failed\";\n}else if(steps.checkExecutionStatus_getNewAccessToken.response.body.status === \"failed\"){\n  executionData.status = \"failed\";\n}else if(steps.checkExecutionStatus_getNewAccessToken.response.body.status === \"success\"){\n  executionData.status = \"succeeded\";\n  for(var i=0;i<=steps.checkExecutionStatus_getNewAccessToken.response.body.stepExecutions.length;i++){\n    if(steps.checkExecutionStatus_getNewAccessToken.response.body.stepExecutions[i][\"stepName\"] === \"Success\") {\n      executionData.result = steps.checkExecutionStatus_getNewAccessToken.response.body.stepExecutions[i];\n      break;\n    }\n    \n    if(steps.checkExecutionStatus_getNewAccessToken.response.body.stepExecutions[i][\"stepName\"] === \"Failed\") {\n      executionData.result = steps.checkExecutionStatus_getNewAccessToken.response.body.stepExecutions[i];\n      executionData.status = \"failed\";\n      break;\n    }\n  }\n}else if(steps.checkExecutionStatus_getNewAccessToken.response.body.status === \"pending\"){\n  executionData.status = \"running\";\n}\n\ndone({\n  executionData: executionData\n});"}},{"id":216412,"onSuccess":[],"onFailure":[],"name":"Failed","type":"script","properties":{"body":"// let card = {\n//     \"cards\": [{\n//         \"id\": \"check2\",\n//         \"card\": {\n//             \"type\": \"ACTION\",\n//             \"heading\": \"Error\",\n//             \"listContent\": [\n//                 \"Failed to update API Token.Please try again.\"\n//             ],\n//             \"icon\": \"WARNING\"\n//         },\n//         \"isCardDone\":\"true\"\n//     }],\n//     \"save\":{\n//       \t\"id\":\"resolve\",\n//       \t\"display\" : \"Resolve\",\n//       \t\"icon\" : \"ARROW\",\n//       \t\"buttonLook\":\"FILLED\",\n//       \t\"type\" : \"DIRECT_LINK\",\n//       \t\"request\":{\n//     \t\t\"type\":\"ON_CLICK_DEFAULT_ACTION\",\n//     \t\t\"apiEndPoint\":{\n//             \t\"apiUrl\":\"https://staging.cloud-elements.com/elements/api-v2/pipedrive/manageSyncRules\",\n//             \t\"type\":\"POST\",\n//             \t\"headers\":{\n//               \t\t\"Elements-Formula-Instance-Id\": info.formulaInstanceId\n//             \t},\n//             \t\"input\":{\n//               \t\t\"apiKey\": steps.InputParams.params.input.apiKey,\n//               \t\t\"siteName\" : steps.InputParams.params.input.siteName,\n//               \t\t\"siteDomain\" : steps.InputParams.params.input.siteDomain,\n//               \t\t\"integrationName\": steps.InputParams.params.input.integrationName\n//             \t}\n//         \t}\n//       \t}\n//     },\n//     \"isCardDone\":\"true\"\n// };\n\nlet card = {\n  \"cards\": [{\n      \"card\": {\n        \"type\": \"ACTION\",\n        \"heading\": \"Error\",\n        \"subHeading\": \"Failed to update API Token.Please try again.\",\n        \"icon\" : \"ERROR\",\n        \"buttons\": [{\n            \"id\": \"direct\",\n            \"display\": \"Resolve\",\n            \"icon\": \"ARROW\",\n            \"type\": \"DIRECT_LINK\",\n            \"buttonLook\":\"FILLED\",\n            \"request\": {\n              \"type\": \"ON_CLICK_GET_CARD\",\n              \"apiEndPoint\": {\n                \"apiUrl\": \"https://staging.cloud-elements.com/elements/api-v2/pipedrive/manageSyncRules\",\n                \"type\": \"GET\",\n                \"headers\": {\n                    \"Elements-Formula-Instance-Id\": info.formulaInstanceId\n                },\n                \"input\":{\n                  \"apiKey\": steps.InputParams.params.input.apiKey,\n      \t\t        \"siteName\" : steps.InputParams.params.input.siteName,\n      \t\t        \"siteDomain\" : steps.InputParams.params.input.siteDomain,\n      \t\t        \"integrationName\": steps.InputParams.params.input.integrationName\n                }\n              }\n            }\n        }]\n    },\n    \"id\": \"check2\",\n    \"showRetry\": \"false\"\n  }]\n};\n\ndone({\n  statusCode: 200,\n  result: card\n});"}},{"id":216413,"onSuccess":[],"onFailure":[],"name":"failedToGetAccessToken","type":"script","properties":{"body":"let card = {\n  \"cards\" : [\n      {\n        \"card\": {\n        \"type\" : \"EMPTY_BACKGROUND\",\n        \"heading\":\"Deal Settings For Subscriptions\",\n          \"contents\":[\n            \"How would you like to handle deals in pipedrive when changes are made in subscriptions in Chargebee. <a href=\\\"\\\" target=\\\"blank\\\">Learn more</a>\"\n            ]\n        },\n        \"isCardDone\": \"true\"\n      }\n    ]\n};\n\ndone({\n  statusCode: 200,\n  card: card\n});\n\n// done({\n//   message : \"Failed to Get New Access Token\"\n// });"}},{"id":225906,"onSuccess":["getInstances"],"onFailure":[],"name":"formulaIdList","type":"script","properties":{"body":"let formula_SyncRulesDealsConfig = steps.ConfigParams.params.input.formulas.formula_SyncRulesDealsConfig;\nlet formula_SyncFieldsConfig = steps.ConfigParams.params.input.formulas.formula_SyncFieldsConfig;\n\nlet formula_ValidateIgnore = steps.ConfigParams.params.input.formulas.formula_ValidateIgnore;\n\n// let formula_InitialSyncRun = steps.ConfigParams.params.input.formulas.formula_InitialSyncRun;\n// let formula_FullSyncRun = steps.ConfigParams.params.input.formulas.formula_FullSyncRun;\n\nlet formula_SyncDispatcher = steps.ConfigParams.params.input.formulas.formula_SyncDispatcher;\n\nlet formula_ManageSyncRules_Save = steps.ConfigParams.params.input.formulas.formula_ManageSyncRules_Save;\n\nlet formula_GetRefreshToken = steps.ConfigParams.params.input.formulas.formula_GetRefreshToken;\n\nlet formulaList=[formula_SyncRulesDealsConfig,formula_SyncFieldsConfig,formula_ValidateIgnore,formula_SyncDispatcher,formula_ManageSyncRules_Save,formula_GetRefreshToken];\n\n// formula_InitialSyncRun,formula_FullSyncRun,\n\ndone({formulaList:formulaList});\n\n"}},{"id":225899,"onSuccess":["getInstances"],"onFailure":[],"name":"formulaInformation","type":"script","properties":{"body":"let siteName = steps.InputParams.params.input.siteName;\n\nlet formula_ManageSyncRules_Save = steps.getTpConfig.response.body.third_party_configuration.config_json.cloudElements.formulas.formula_ManageSyncRules_Save.id;\n\ndone({\n  formula_ManageSyncRules_Save:{\n    active: true,\n    configuration: {},\n    name: siteName + \"-ManageSyncRules_Save\"\n  },\n  formulaId:formula_ManageSyncRules_Save\n});"}},{"id":216414,"onSuccess":["getResultAccessToken"],"onFailure":[],"name":"getAccessTokenResult_params","type":"script","properties":{"body":"// let executionData = steps.checkExecutionStatus_getNewAccessToken.response.body.entry;\n\n// for(var i=0;i < executionData.stepExecutions.length; i++){\n//   if(executionData.stepExecutions[i]['stepName'] === \"Success\"){\n//     stepId = executionData.stepExecutions[i]['id'];\n//     break;\n//   }\n// }\n\nlet executionData = steps.executionStatus_getNewAccessToken.executionData.result;\nlet stepId = null;\n\nif(executionData.stepName === \"Success\"){\n  stepId = executionData.id;\n}\n\nlet payload = {\n  url: \"/formulas/instances/executions/steps/\"+stepId+\"/values\"\n};\n\ndone({\n    payload: payload\n});"}},{"id":222922,"onSuccess":["Success"],"onFailure":[],"name":"getCustomFieldsFromChargebee","type":"httpRequest","properties":{"query":"${steps.InputParams.getCustomFieldApi.query}","retryDelay":"200","url":"${steps.InputParams.getCustomFieldApi.url}","headers":"${steps.InputParams.getCustomFieldApi.headers}","retry":"true","method":"GET","retryAttempts":"5"}},{"id":225907,"onSuccess":["checkInstanceExist"],"onFailure":[],"name":"getInstances","type":"request","properties":{"api":"/formulas/${steps.formulaInformation.formulaId}/instances","method":"GET"}},{"id":216415,"onSuccess":["accessTokenFormulaDetails"],"onFailure":[],"name":"getNewAccessToken","type":"request","properties":{"body":"${steps.triggerRefreshToken.triggerParams.body}","api":"${steps.triggerRefreshToken.triggerParams.url}","method":"POST"}},{"id":216416,"onSuccess":["getThirdPartyInstanceDetails"],"onFailure":[],"name":"getNewToken","type":"httpRequest","properties":{"retryDelay":"200","body":"${steps.getNewToken_params.payload.body}","url":"${steps.getNewToken_params.payload.url}","headers":"${steps.getNewToken_params.payload.headers}","retry":"true","retryAttempts":"5","method":"POST"}},{"id":216417,"onSuccess":["getThirdPartyInstanceDetails"],"onFailure":[],"name":"getNewToken_params","type":"script","properties":{"body":"if(steps.getTpConfig.response.body.third_party_configuration.config_json.cloudElements.OAuth_Parameters === undefined){\n  done(false);\n}\n\nlet params = steps.getTpConfig.response.body.third_party_configuration.config_json.cloudElements.OAuth_Parameters;\n\nlet payload = {\n  url: \"https://oauth.pipedrive.com/oauth/token\",\n  headers : {\n    \"Content-Type\" : \"application/x-www-form-urlencoded\",\n    \"Authorization\" : \"Basic \" + CE.b64(params.client_info.client_id + \":\" + params.client_info.client_secret)\n  },\n  body : \"grant_type=refresh_token&refresh_token=\" + params.refresh_token\n};\n\ndone({\n  payload: payload\n});"}},{"id":216418,"onSuccess":["listPipelines"],"onFailure":["isTokenExpired"],"name":"getPipelinesFromPipedrive","type":"httpRequest","properties":{"retryDelay":"200","url":"${steps.getPipelinesFromPipedrive_params.payload.url}","headers":"${steps.getPipelinesFromPipedrive_params.payload.header}","retry":"true","retryAttempts":"5","method":"GET"}},{"id":216419,"onSuccess":["getPipelinesFromPipedrive"],"onFailure":[],"name":"getPipelinesFromPipedrive_params","type":"script","properties":{"body":"let payload = {\n  url : \"https://api-proxy.pipedrive.com/pipelines\",\n  header: {\n    \"Authorization\": steps.ConfigParams.config.pipedriveApiToken || null\n  }\n}\n\n\ndone({\n  payload: payload\n});"}},{"id":216420,"onSuccess":["resultPublished"],"onFailure":[],"name":"getResultAccessToken","type":"request","properties":{"api":"${steps.getAccessTokenResult_params.payload.url}","method":"GET"}},{"id":222880,"onSuccess":["addStagesToList"],"onFailure":["isTokenExpired"],"name":"getStagesFromPipedrive","type":"httpRequest","properties":{"query":"${steps.getStagesFromPipedrive_params.payload.query}","url":"${steps.getStagesFromPipedrive_params.payload.url}","headers":"${steps.getStagesFromPipedrive_params.payload.header}","method":"GET"}},{"id":222879,"onSuccess":["getStagesFromPipedrive"],"onFailure":[],"name":"getStagesFromPipedrive_params","type":"script","properties":{"body":"let pipelineId = steps.loopOverPipelines.entry.value;\nlet stageList = [];\n\nlet payload = {\n  url : \"https://api-proxy.pipedrive.com/stages\",\n  header: {\n    \"Authorization\": steps.getTpConfig.response.body.third_party_configuration.config_json.cloudElements.OAuth_Parameters.access_token || null\n  },\n  query: {\n    \"pipeline_id\" : pipelineId\n  }\n}\n\nif(steps.addStagesToList !== undefined){\n  stageList = steps.addStagesToList.stages;\n}\n\nconsole.log(stageList.length);\n\ndone({\n  payload: payload,\n  stageList: stageList\n});"}},{"id":216421,"onSuccess":["updateElementInstanceParams"],"onFailure":[],"name":"getThirdPartyInstanceDetails","type":"request","properties":{"api":"/instances/${steps.getTpConfig.response.body.third_party_configuration.config_json.cloudElements.thirdParty.instance}","method":"GET"}},{"id":216422,"onSuccess":["isManageSyncRulesSaveInstanceExist"],"onFailure":[],"name":"getTpConfig","type":"httpRequest","properties":{"retryDelay":"200","query":"${steps.InputParams.getTpConfigParams.query}","url":"${steps.InputParams.getTpConfigParams.url}","headers":"${steps.InputParams.getTpConfigParams.auth}","retry":"true","retryAttempts":"5","method":"GET"}},{"id":216423,"onSuccess":["getTpConfig"],"onFailure":[],"name":"InputParams","type":"script","properties":{"body":"let apiKey = trigger.args.request.query['cb-api-key'];\nlet siteName = trigger.args.request.query['cb-site-name'];\nlet integrationName = trigger.args.request.query['integrationName'];\nlet siteDomain = trigger.args.request.query['cb-domain'];\n\n// let apiKey = \"test_FdeKa4XuFlZ6ZxikZjIrNLu1VNOkocOq\";\n// let siteName = \"ipaas-test\";\n// let integrationName = 'pipedrive';\n// let siteDomain = \"chargebee-labs.com\";\nlet password = \"\";\nlet tokenUpdateExecutionId = trigger.args.request.query['tokenUpdateExecutionId'] || null;\nlet action = trigger.args.request.query['action'] || null;\n\nlet errorEmailEndpoint =  'https://' + siteName + '.' + siteDomain + '/adhoc_checkout_email/api/send';\n// let errorEmailAddress = \"integrations-growth-internal@chargebee.com\";\nlet errorEmailAddress = \"ajaitester@gmail.com\";\n\nlet getTpConfigParams = {\n    url: \"https://\"+siteName+\".\"+siteDomain+\"/api/v2/third_party_configurations\",\n    auth:{\n      Authorization: \"Basic \" + CE.b64(apiKey + \":\" + password)\n    },\n    query:{\n      integration_name: integrationName\n    }\n};\n\nlet updateTpConfigParams = {\n  url: \"https://\"+siteName+\".integrations.\"+siteDomain+\"/integrations/update_tp_integ_conf\",\n  headers: {\n    \"Content-Type\": \"application/json\",\n    \"cache-control\": \"no-cache\"\n  },\n  body: {\n     site_name: siteName,\n     api_key: apiKey,\n     integration_name: integrationName\n     //append config_json with this during request\n  }\n};\n\nlet sendErrorMailParams = {\n  url: errorEmailEndpoint,\n  headers:{\n    Authorization: \"Basic \" + CE.b64(apiKey + \":\" + \"\")\n  },\n  query :{\n    content : \"Integration Error, Formula-Instance-ID : \",\n    subject : \"Fatal Error Occurred during \" + integrationName + \" Initial Sync\",\n    to_address : errorEmailAddress,\n    api_key : apiKey\n  }\n};\n\nlet unlink =  {\n        \"id\": \"unlink\",\n        \"display\": \"Unlink Integration\",\n        \"buttonLook\": \"MUTTED\",\n        \"type\": \"POP_UP\",\n        \"popUp\": {\n            \"type\": \"SIMPLE\",\n            \"title\": \"Do you really want to unlink the integration?\",\n            \"submitButton\": \"Unlink\",\n            \"cancelButton\": \"Dismiss\",\n            \"description\": \"This will remove all the configuration details such as login authentication, configurations mapping etc. If you want to sync again, you will have to start the sync process from the beginning.\",\n            \"apiEndPoint\": {\n                \"apiUrl\": \"https://staging.cloud-elements.com/elements/api-v2/pipedrive/unlink\",\n                \"type\": \"GET\",\n                \"headers\": {\n                    \"Elements-Formula-Instance-Id\": \"393556\"\n                },\n                \"input\": {\n                    \"integrationName\": integrationName,\n                    \"siteDomain\": siteDomain,\n                    \"apiKey\" : apiKey,\n                    \"siteName\": siteName\n                }\n            }\n        }\n  }\n  \nlet getCustomFieldApi = {\n  url: \"https://\"+siteName+\".integrations.\"+siteDomain+\"/integrations/api/get_custom_field_list\",\n  headers:{\n    Authorization: \"Basic \" + CE.b64(apiKey + \":\" + password)\n  },\n  query:{\n    site_name: siteName,\n    api_key: apiKey\n  }\n}\n\nlet params = {\n  input: {\n    apiKey: apiKey,\n    siteName: siteName,\n    siteDomain:siteDomain,\n    integrationName: integrationName,\n    errorEmailEndpoint: errorEmailEndpoint,\n    errorEmailAddress: errorEmailAddress,\n    tokenUpdateExecutionId: tokenUpdateExecutionId,\n    action : action\n  }\n};\n\ndone({\n  params: params,\n  getTpConfigParams: getTpConfigParams,\n  updateTpConfigParams: updateTpConfigParams,\n  sendErrorMailParams: sendErrorMailParams,\n  getCustomFieldApi: getCustomFieldApi,\n  unlink: unlink\n});"}},{"id":216424,"onSuccess":["getAccessTokenResult_params"],"onFailure":["isFailed_getNewAccessToken"],"name":"isAccessTokenFormulaDone","type":"filter","properties":{"body":"if(steps.executionStatus_getNewAccessToken.executionData.status === \"succeeded\"){\n  done(true);\n}\n\ndone(false);"}},{"id":216425,"onSuccess":["sendProcessCard"],"onFailure":["failedToGetAccessToken"],"name":"isFailed_getNewAccessToken","type":"filter","properties":{"body":"if(steps.executionStatus_getNewAccessToken.executionData.status === \"running\"){\n  done(true);\n}\n\nif(steps.executionStatus_getNewAccessToken.executionData.status === \"failed\"){\n  done(false);\n}"}},{"id":225908,"onSuccess":["updateTpConfigParams_2"],"onFailure":["createFormulaInstanceParams"],"name":"isInstanceExist","type":"filter","properties":{"body":"done(steps.checkInstanceExist.flag);"}},{"id":225896,"onSuccess":["isTokenAboutToExpire"],"onFailure":["formulaInformation"],"name":"isManageSyncRulesSaveInstanceExist","type":"filter","properties":{"body":"if(steps.getTpConfig.response.body.third_party_configuration.config_json.cloudElements.formulas.formula_ManageSyncRules_Save.instance === undefined){\n  done(false);\n}\n\ndone(true);"}},{"id":216426,"onSuccess":["ConfigParams"],"onFailure":["alreadyExecutionExist"],"name":"isTokenAboutToExpire","type":"filter","properties":{"body":"if(steps.InputParams.params.input.action === \"tokenUpdatePending\"){\n  done(false);\n}\n\nif(steps.InputParams.params.input.action === \"tokenUpdateSuccess\"){\n  done(true);\n}\n\n// let currentTime = Math.round((new Date().getTime())/1000);\n// let expiryTime = steps.getTpConfig.response.body.third_party_configuration.config_json.cloudElements.OAuth_Parameters.expiry_time || 0;\n\n// console.log(currentTime);\n// console.log(expiryTime);\n// console.log((expiryTime - currentTime) > (30 * 60));\n\n// if((expiryTime - currentTime) > (30 * 60)){ //Difference greater than 30 minutes (Unix Timestamp)\n//   done(true);\n// }\n\n// done(false);\n\ndone(true);"}},{"id":222883,"onSuccess":["triggerRefreshToken"],"onFailure":["Error"],"name":"isTokenExpired","type":"filter","properties":{"body":"if(steps.getPipelinesFromPipedrive !== undefined){\n  if(steps.getPipelinesFromPipedrive.response.code === 401){\n    done(true);\n  }\n}\n\nif(steps.getStagesFromPipedrive !== undefined){\n if(steps.getStagesFromPipedrive.response.code === 401){\n   done(true);\n }\n}\n\ndone(false);"}},{"id":216427,"onSuccess":["loopOverPipelines"],"onFailure":[],"name":"listPipelines","type":"script","properties":{"body":"if((steps.getPipelinesFromPipedrive.response.code !== 200) || (steps.getPipelinesFromPipedrive.response.body.data === undefined) || (steps.getPipelinesFromPipedrive.response.body.data.length === 0)){\n  done(false);\n}\n\n\nlet pipelineData = steps.getPipelinesFromPipedrive.response.body.data;\nlet temp;\nlet outputData = [];\n\nfor(var i=0; i < pipelineData.length; i++){\n  if(pipelineData[i].active === false){\n    continue;\n  }\n  \n  // temp = {\n  //   \"id\" : pipelineData[i].id,\n  //   \"name\" : pipelineData[i].name\n  // }\n  \n  temp = {\n    \"value\": pipelineData[i].id,\n    \"disp\": pipelineData[i].name,\n    \"helptext\": \"Last Created Open deal will be updated in Pipedrive. <a href='' target='blank'>Learn More</a>\" \n   };\n   outputData.push(temp);\n  // pipelineDropdownContent.push(temp);\n  \n}\n\ntemp = {\n  \"value\":\"doNothing\",                       \n  \"disp\":\"Do Nothing\"       \n};\n\noutputData.push(temp);\n\n\ndone({\n  pipeline: outputData\n});\n"}},{"id":222882,"onSuccess":["getCustomFieldsFromChargebee"],"onFailure":[],"name":"listStages","type":"script","properties":{"body":"let stageList = [];\n\nif(steps.addStagesToList !== undefined){\n  stageList = steps.addStagesToList.stages;\n}\n\ndone({\n  stageList : stageList\n});"}},{"id":222878,"onSuccess":["getStagesFromPipedrive_params"],"onFailure":["listStages"],"name":"loopOverPipelines","type":"loop","properties":{"list":"${steps.listPipelines.pipeline.entry}"}},{"id":225911,"onSuccess":["updateTpConfigParams_2"],"onFailure":[],"name":"newInstanceCreatedInfo","type":"script","properties":{"body":"done({\n  id: steps.createFormulaInstance.response.body.id\n});"}},{"id":216428,"onSuccess":["getThirdPartyInstanceDetails"],"onFailure":[],"name":"OAuthDetails","type":"script","properties":{"body":"let result = steps.getResultAccessToken.response.body;\n\nlet OAuthData = null;\n\nfor(var i=0; i < result.length; i++){\n  if(result[i]['key'] === \"Success.result\"){\n    OAuthData = JSON.parse(result[i]['value']);\n    break;\n  }\n}\n\n\ndone({\n  OAuthData: OAuthData\n});"}},{"id":222877,"onSuccess":["OAuthDetails"],"onFailure":["sendProcessCard"],"name":"resultPublished","type":"filter","properties":{"body":"if((steps.getResultAccessToken.response.code === 200) && ((steps.getResultAccessToken.response.body.length === 0) || (steps.getResultAccessToken.response.body === null))){\n  done(false);\n}\n\ndone(true);\n"}},{"id":216429,"onSuccess":[],"onFailure":[],"name":"sendProcessCard","type":"script","properties":{"body":"let cloudElementsUrl = steps.EnvProps.cloudElementsUrl;\nlet instanceId = info.formulaInstanceId;\n\nlet manageSyncRulesSaveInstance = steps.getTpConfig.response.body.third_party_configuration.config_json.cloudElements.formulas.formula_ManageSyncRules_Save.instance || null;\n\n// steps.getTpConfig.response.body.third_party_configuration.config_json.cloudElements.formulas.formula_SyncRulesDealsSetup.instance\n\nlet card = {\n   \"cards\":[\n      {\n         \"card\": {\n            \"type\" : \"PROCESSING\",\n            \"processingText\": \" Loading...\",\n            \"request\" : {\n               \"type\":\"DOC_READY_GET_CARD\",\n               \"apiEndPoint\":{\n                  \"apiUrl\": cloudElementsUrl+\"/pipedrive/manageSyncRules\",\n                        \"type\": \"GET\",\n                        \"headers\": {\n                            \"Elements-Formula-Instance-Id\": instanceId\n                        },\n                        \"input\":{\n                            \"integrationName\": steps.InputParams.params.input.integrationName,\n                            \"siteDomain\": steps.InputParams.params.input.siteDomain,\n                            \"action\": \"tokenUpdatePending\",\n                            \"tokenUpdateExecutionId\" : steps.accessTokenFormulaDetails.formulaExecutionDetails.excecutionId || null\n                        }\n               }\n            }\n         },\n         \"id\" : \"testdynamic2\",\n      } \n   ],\n   \"save\":{\n      \t\"id\":\"save\",\n      \t\"display\" : \"Save\",\n      \t\"icon\" : \"ARROW\",\n      \t\"buttonLook\":\"FILLED\",\n      \t\"type\" : \"DIRECT_LINK\",\n      \t\"request\":{\n     \t\t\"type\":\"ON_CLICK_SEND_INPUT\",\n     \t\t\"apiEndPoint\":{\n            \t\"apiUrl\":cloudElementsUrl+\"/pipedrive/saveSyncRules\",\n            \t\"type\":\"POST\",\n            \t\"headers\":{\n               \t\t\"Elements-Formula-Instance-Id\":manageSyncRulesSaveInstance\n            \t},\n            \t\"input\":{\n               \t\t\"id\":\"chargebee\",\n               \t\t\"apiKey\": steps.InputParams.params.input.apiKey,\n               \t\t\"siteName\" : steps.InputParams.params.input.siteName,\n               \t\t\"siteDomain\" : steps.InputParams.params.input.siteDomain,\n               \t\t\"integrationName\": steps.InputParams.params.input.integrationName\n            \t}\n         \t}\n      \t}\n    },\n    \"dismissText\" : \"Dismiss\"\n};\n\ndone({\n statusCode: 200,\n result: card\n});\n\n"}},{"id":225917,"onSuccess":[],"onFailure":[],"name":"sendProcessCard_instanceCreation","type":"script","properties":{"body":"let cloudElementsUrl = steps.EnvProps.cloudElementsUrl;\nlet instanceId = info.formulaInstanceId;\n\nlet manageSyncRulesSaveInstance = steps.getTpConfig.response.body.third_party_configuration.config_json.cloudElements.formulas.formula_ManageSyncRules_Save.instance || null;\n\nlet card = {\n   \"cards\":[\n      {\n         \"card\": {\n            \"type\" : \"PROCESSING\",\n            \"processingText\": \" Loading...\",\n            \"request\" : {\n               \"type\":\"DOC_READY_GET_CARD\",\n               \"apiEndPoint\":{\n                  \"apiUrl\": cloudElementsUrl+\"/pipedrive/manageSyncRules\",\n                        \"type\": \"GET\",\n                        \"headers\": {\n                            \"Elements-Formula-Instance-Id\": instanceId\n                        },\n                        \"input\":{\n                            \"integrationName\": steps.InputParams.params.input.integrationName,\n                            \"siteDomain\": steps.InputParams.params.input.siteDomain\n                        }\n               }\n            }\n         },\n         \"id\" : \"testdynamic2\",\n      } \n   ],\n   \"save\":{\n      \t\"id\":\"save\",\n      \t\"display\" : \"Save\",\n      \t\"icon\" : \"ARROW\",\n      \t\"buttonLook\":\"FILLED\",\n      \t\"type\" : \"DIRECT_LINK\",\n      \t\"request\":{\n     \t\t\"type\":\"ON_CLICK_SEND_INPUT\",\n     \t\t\"apiEndPoint\":{\n            \t\"apiUrl\":cloudElementsUrl+\"/pipedrive/saveSyncRules\",\n            \t\"type\":\"POST\",\n            \t\"headers\":{\n               \t\t\"Elements-Formula-Instance-Id\":manageSyncRulesSaveInstance\n            \t},\n            \t\"input\":{\n               \t\t\"id\":\"chargebee\",\n               \t\t\"apiKey\": steps.InputParams.params.input.apiKey,\n               \t\t\"siteName\" : steps.InputParams.params.input.siteName,\n               \t\t\"siteDomain\" : steps.InputParams.params.input.siteDomain,\n               \t\t\"integrationName\": steps.InputParams.params.input.integrationName\n            \t}\n         \t}\n      \t}\n    },\n    \"dismissText\" : \"Dismiss\"\n};\n\ndone({\n statusCode: 200,\n result: card\n});"}},{"id":216430,"onSuccess":[],"onFailure":[],"name":"SendProcessCardSuccess","type":"script","properties":{"body":"let cloudElementsUrl = steps.EnvProps.cloudElementsUrl;\nlet instanceId = info.formulaInstanceId;\n\nlet manageSyncRulesSaveInstance = steps.getTpConfig.response.body.third_party_configuration.config_json.cloudElements.formulas.formula_ManageSyncRules_Save.instance || null;\n\n// steps.getTpConfig.response.body.third_party_configuration.config_json.cloudElements.formulas.formula_SyncRulesDealsSetup.instance\n\nlet card = {\n   \"cards\":[\n      {\n         \"card\": {\n            \"type\" : \"PROCESSING\",\n            \"processingText\": \" Loading...\",\n            \"request\" : {\n               \"type\":\"DOC_READY_GET_CARD\",\n               \"apiEndPoint\":{\n                  \"apiUrl\": cloudElementsUrl+\"/pipedrive/manageSyncRules\",\n                        \"type\": \"GET\",\n                        \"headers\": {\n                            \"Elements-Formula-Instance-Id\": instanceId\n                        },\n                        \"input\":{\n                            \"integrationName\": steps.InputParams.params.input.integrationName,\n                            \"siteDomain\": steps.InputParams.params.input.siteDomain,\n                            \"action\": \"tokenUpdateSuccess\"\n                        }\n               }\n            }\n         },\n         \"id\" : \"testdynamic2\",\n      } \n   ],\n   \"save\":{\n      \t\"id\":\"save\",\n      \t\"display\" : \"Save\",\n      \t\"icon\" : \"ARROW\",\n      \t\"buttonLook\":\"FILLED\",\n      \t\"type\" : \"DIRECT_LINK\",\n      \t\"request\":{\n     \t\t\"type\":\"ON_CLICK_SEND_INPUT\",\n     \t\t\"apiEndPoint\":{\n            \t\"apiUrl\":cloudElementsUrl+\"/pipedrive/saveSyncRules\",\n            \t\"type\":\"POST\",\n            \t\"headers\":{\n               \t\t\"Elements-Formula-Instance-Id\":manageSyncRulesSaveInstance\n            \t},\n            \t\"input\":{\n               \t\t\"id\":\"chargebee\",\n               \t\t\"apiKey\": steps.InputParams.params.input.apiKey,\n               \t\t\"siteName\" : steps.InputParams.params.input.siteName,\n               \t\t\"siteDomain\" : steps.InputParams.params.input.siteDomain,\n               \t\t\"integrationName\": steps.InputParams.params.input.integrationName\n            \t}\n         \t}\n      \t}\n    },\n    \"dismissText\" : \"Dismiss\"\n};\n\ndone({\n statusCode: 200,\n result: card\n});\n\n"}},{"id":216431,"onSuccess":[],"onFailure":[],"name":"Success","type":"script","properties":{"body":"let cloudElementsUrl = steps.EnvProps.cloudElementsUrl;\nlet getOrganizationSettingsInstance = steps.EnvProps.getOrganizationSettingsInstance;\n\nlet siteDomain = trigger.args.request.query['cb-domain'];\nlet integrationName = trigger.args.request.query['integrationName'];\n\nlet pipelineList = steps.listPipelines.pipeline;\nlet stagesList = steps.listStages.stageList;\nlet configJson = steps.ConfigParams.tpConfig.third_party_configuration.config_json.cloudElements || null;\n\nlet getPipelineStagesInstance = configJson.formulas.formula_GetPipelineStages.instance || null;\n\nlet linkSubAttributesToPerson = configJson.syncRulesContacts.linkSubAttributesToPerson;\n\nlet manageSyncRulesSaveInstance = configJson.formulas.formula_ManageSyncRules_Save.instance || null;\n\nif(configJson === null){\n  done(false);\n}\n\n\nlet temp;\nlet customFields = JSON.parse(steps.getCustomFieldsFromChargebee.response.body.response) || null;\nlet chargebeeCustomFields;\nlet customFields_customer;\nlet customFields_subscription;\nif (customFields !== null) {\n    customFields_customer = Object.keys(customFields.customer_custom_fields) || [];\n    customFields_subscription = Object.keys(customFields.subscription_custom_fields) || [];\n}\n\nlet default_allowedValues = {\n  \"email\": \"Email\",\n  \"id\": \"Customer ID\"\n};\n\nlet allowedValues = Object.assign(default_allowedValues,customFields_customer);\n\nlet card = {\n   \"cards\" : [\n     {\n        \"card\": {\n        \"type\" : \"EMPTY_BACKGROUND\",\n        \"heading\":\"Sync Rules for Contacts\",\n          \"contents\":[\n            \"Configure how customer and subscription data is synced from Chargebee to Pipedrive. Set rules to manage 'People' and 'Organizations' in Pipedrive from Chargebee.<a href=\\\"https://www.chargebee.com\\\" target=\\\"blank\\\">Learn More</a>\"\n            ]\n        }\n      },\n      {\n          \"card\": {\n              \"type\" : \"INPUT\",\n              \"params\": [\n                  {  \n                          \"dispName\":\"Choose customers you'd like to sync\",\n                          \"type\":\"DROPDOWN_DYNAMIC\",\n                          \"id\":\"chooseCustomersToSync\",\n                          \"dropDownItemsList\":[\n                              {\n                                  \"value\":\"option1\",\n                                  \"disp\":\"Sync All Customers\"\n                              },\n                              {\n                                  \"value\":\"option2\",\n                                  \"disp\":\"Sync Only Customers with Subscriptions\"\n                              }\n                          ],\n                          \"defaultVal\": (configJson.syncRulesContacts.chooseCustomersToSync !== undefined) ? configJson.syncRulesContacts.chooseCustomersToSync : \"option1\"\n                  }\n              ]\n          },\n          \"id\" : \"check1\"\n      },\n      // {\n      //   \"card\": {\n      //       \"type\" : \"INPUT\",\n      //       \"params\": [\n      //       \t{  \n\t\t\t   //      \"dispName\":\"Choose customers you'd like to sync\",\n\t\t\t   //      \"req\":\"true\",\n\t\t\t   //      \"type\":\"DROPDOWN\",\n\t\t\t   //      \"id\":\"chooseCustomersToSync\",\n\t\t\t   //      \"allowedValues\":{\n\t\t\t   //         \"option1\":\"Sync All Customers\",\n\t\t\t   //         \"option2\":\"Sync only customers with subscriptions\"\n\t\t\t   //      },\n\t\t\t   //      \"defaultVal\": configJson.syncRulesContacts.chooseCustomersToSync || null\n\t\t\t   // }\n      //       ]\n      //   },\n      //   \"id\" : \"check1\"\n      // },\n      {\n        \"card\": {\n            \"type\" : \"DYNAMIC_INPUT\",\n            \"params\": [\n               {       \n                \"dispName\":\"Allow Chargebee to create 'People' in Pipedrive\",\n                      \"desc\":\"By default, existing people, if any, will be updated with the changes made in Chargebee. Disable if you dont want chargebee to create 'People' in Pipedrive. <a href=\\\"https://www.chargebee.com\\\" target=\\\"blank\\\">Learn More</a>\",\n                  \"type\":\"DROPDOWN_DYNAMIC\",\n                  \"id\":\"createPeopleInPipedrive\",\n                  \"dropDownItemsList\":[\n                      {\n                      \"value\":\"true\",\n                          \"disp\":\"Create person\"\n                      },\n                      {\n                      \"value\":\"false\",\n                          \"disp\":\"Do nothing\"\n                      }\n                  ],\n                \"defaultVal\": (configJson.syncRulesContacts !== undefined) ? ((configJson.syncRulesContacts.createPeopleInPipedrive !== undefined) ? configJson.syncRulesContacts.createPeopleInPipedrive : \"true\") : \"true\",\n                \"isSeperator\":true\n              },\n        // \"card\": {\n        //     \"type\" : \"DYNAMIC_INPUT\",\n        //     \"params\": [\n        //       {       \n        //       \"dispName\":\"Allow Chargebee to create 'People' in Pipedrive\",\n        //             \"desc\":\"By default, existing people, if any, will be updated with the changes made in Chargebee. Disable if you dont want chargebee to create People in Pipedrive\",\n        //         \"type\":\"TOGGLE\",\n        //         \"id\":\"createPeopleInPipedrive\",\n        //         \"defaultVal\": (configJson.syncRulesContacts !== undefined) ? ((configJson.syncRulesContacts.createPeopleInPipedrive === \"false\") ? false : true) : true,\n        //         \"isSeperator\":true\n        //       },\n              {       \n                \"dispName\":\"Allow Chargebee to manage 'Organization' in Pipedrive\",\n                \"desc\":\"By default, Chargebee customers will be synced as 'People' in Pipedrive. Enable if you want to allow Chargebee to add people to 'Organization', and create and update Organizations in Pipedrive. <a href=\\\"https://www.chargebee.com\\\" target=\\\"blank\\\">Learn More</a>\",\n                \"type\":\"TOGGLE\",\n                \"id\":\"manageOrganizationInPipedrive\",\n                \"defaultVal\": (configJson.syncRulesContacts !== undefined) ? ((configJson.syncRulesContacts.manageOrganizationInPipedrive === \"true\") ? true : false) : false,\n                \"isSeperator\":true,\n                \"isDynamic\":\"true\",\n                \"isDisabled\":true,\n                \"request\":{\n                  \"type\":\"ON_CHANGE_FETCH_INPUT\",\n                  \"apiEndPoint\":{\n                    \"apiUrl\":cloudElementsUrl+\"/pipedrive/getOrganizationSettings\",\n                    \"type\":\"GET\",\n                    \"headers\":{\n                      \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                      \"Elements-Formula-Instance-Id\": getOrganizationSettingsInstance\n                    },\n                    \"input\":{\n                      \"card\":\"subscription\"\n                    }\n                  }\n                }\n             },\n             {  \n              \"dispName\":\"When a customer is deleted in Chargebee\",\n               \"type\":\"DROPDOWN_DYNAMIC\",\n               \"id\":\"customerDeletedInCB\",\n               \"dropDownItemsList\":[\n                       {\n                        \"value\":\"option1\",\n                          \"disp\":\"Do Nothing\"\n                       },\n                       {\n                        \"value\":\"option2\",\n                          \"disp\":\"Mark 'Person'as 'Deleted'\"\n                       }\n               ],\n                \"defaultVal\": (configJson.syncRulesContacts !== undefined) ? configJson.syncRulesContacts.customerDeletedInCB : \"option2\"\n              }\n            ]\n         },\n         \"id\" : \"check2\"\n      },\n      {\n        \"card\": {\n          \"type\" : \"MAPPING\",\n          \"heading\": \"Map Customers from Chargebee to Pipedrive\",\n          \"contents\": \"Choose a unique field to identify and sync customers from Chargebee to Pipedrive <a href=\\\"https://www.chargebee.com\\\" target=\\\"blank\\\">Learn More</a>\",\n          \"leftComponent\":{\n            \"id\": \"mapField_chargebee\",\n            \"title\": \"Chargebee Customer Field\",\n            \"allowedValues\": allowedValues,\n            \"defaultValue\": (configJson.syncRulesContacts !== undefined) ? configJson.syncRulesContacts.mappedField : \"email\",\n          },\n          \"rightComponent\":{\n            \"id\": \"mapField_pipedrive\",\n            \"title\": \"Pipedrive Person Field\",\n            \"allowedValues\":{\n              \"email\": \"Email\",\n              \"pipedrive_person_id\": \"Pipedrive Person ID\"\n            },\n            \"defaultValue\": (configJson.syncRulesContacts !== undefined) ? configJson.syncRulesContacts.mappedField_pipedrive : \"email\"\n          }\n        },\n        \"id\" : \"check5\",\n        \"isCardDone\":\"true\"\n      },\n   {\n        \"card\": {\n        \"type\" : \"EMPTY_BACKGROUND\",\n        \"heading\":\"Deal Settings For Subscriptions\",\n          \"contents\":[\n            \"How would you like to handle deals in pipedrive when changes are made in subscriptions in Chargebee. <a href=\\\"\\\" target=\\\"blank\\\">Learn more</a>\"\n            ]\n        },\n        \"isCardDone\": \"true\"\n      },\n      {\n        \"card\": {\n            \"heading\": \"Choose how you'd like to handle deals in Pipedrive when\",\n            \"type\" : \"DYNAMIC_INPUT\",\n            \"params\": [\n              {  \n                \"dispName\":\"... subscription is <b>created</b>\",\n                \"req\":\"false\",\n                \"id\":\"subCreated\",\n                \"type\":\"DROPDOWN_DYNAMIC\",\n                \"isDynamic\":\"true\",\n                \"request\":{\n                  \"type\":\"ON_CHANGE_FETCH_INPUT\",\n                  \"apiEndPoint\":{\n                    \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                    \"type\":\"GET\",\n                    \"headers\":{\n                      \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                      \"Elements-Formula-Instance-Id\": getPipelineStagesInstance\n                    },\n                    \"input\":{\n                      \"card\":\"subscription\"\n                    }\n                  }\n                },\n               \"dropDownItemsList\":[\n                  {\n                    \"disp\": \"Create a deal\",\n                    \"value\": \"option1\"\n                  },\n                  {\n                    \"disp\": \"Update existing deal\",\n                    \"value\": \"option2\",\n                    \"helptext\": \"Last Created Open deal will be updated in Pipedrive. <a href='' target='blank'>Learn More</a>\"\n                  },\n                  {\n                    \"disp\": \"Do Nothing\",\n                    \"value\": \"option3\"\n                  }\n                ],\n                  \"defaultVal\":configJson.syncRulesDeals.subCreated\n              },\n              {  \n                \"dispName\":\"... subscription items are <b>updated</b>\",\n                \"req\":\"false\",\n                \"type\":\"DROPDOWN_DYNAMIC\",\n                \"id\":\"subUpdated\",\n                \"isDynamic\":\"true\",\n                \"request\":{\n                  \"type\":\"ON_CHANGE_FETCH_INPUT\",\n                  \"apiEndPoint\":{\n                    \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                    \"type\":\"GET\",\n                    \"headers\":{\n                      \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                      \"Elements-Formula-Instance-Id\": getPipelineStagesInstance\n                    },\n                    \"input\":{\n                      \"card\":\"subscription\"\n                    }\n                  }\n                },\n                \"dropDownItemsList\":[\n                  {\n                    \"disp\": \"Update existing deal\",\n                    \"value\": \"option2\",\n                    \"helptext\": \"Last Created Open deal will be updated in Pipedrive. <a href='' target='blank'>Learn More</a>\"\n                  },\n                  {\n                    \"disp\": \"Do Nothing\",\n                    \"value\": \"option3\"\n                  }\n                ],\n                  \"defaultVal\":configJson.syncRulesDeals.subUpdated\n              },\n              {  \n                \"dispName\":\"... subscription is <b>deleted</b>\",\n                \"req\":\"false\",\n                \"type\":\"DROPDOWN_DYNAMIC\",\n                \"id\":\"subDeleted\",\n                \"isDynamic\":\"true\",\n                \"request\":{\n                  \"type\":\"ON_CHANGE_FETCH_INPUT\",\n                  \"apiEndPoint\":{\n                    \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                    \"type\":\"GET\",\n                    \"headers\":{\n                      \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                      \"Elements-Formula-Instance-Id\": getPipelineStagesInstance\n                    },\n                    \"input\":{\n                      \"card\":\"subscription\"\n                    }\n                  }\n                },\n                \"dropDownItemsList\":[\n                  {\n                    \"disp\": \"Update existing deal\",\n                    \"value\": \"option2\",\n                    \"helptext\": \"Last Created Open deal will be updated in Pipedrive. <a href='' target='blank'>Learn More</a>\"\n                  },\n                  {\n                    \"disp\": \"Do Nothing\",\n                    \"value\": \"option3\"\n                  }\n                ],\n                  \"defaultVal\":configJson.syncRulesDeals.subDeleted\n              },\n              {  \n                \"dispName\":\"... subscription is <b>paused</b>\",\n                \"req\":\"false\",\n                \"type\":\"DROPDOWN_DYNAMIC\",\n                \"id\":\"subPaused\",\n                \"isDynamic\":\"true\",\n                \"request\":{\n                  \"type\":\"ON_CHANGE_FETCH_INPUT\",\n                  \"apiEndPoint\":{\n                    \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                    \"type\":\"GET\",\n                    \"headers\":{\n                      \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                      \"Elements-Formula-Instance-Id\":getPipelineStagesInstance\n                    },\n                    \"input\":{\n                      \"card\":\"subscription\"\n                    }\n                  }\n                },\n                \"dropDownItemsList\":[\n                  {\n                    \"disp\": \"Update existing deal\",\n                    \"value\": \"option2\",\n                    \"helptext\": \"Last Created Open deal will be updated in Pipedrive. <a href='' target='blank'>Learn More</a>\"\n                  },\n                  {\n                    \"disp\": \"Do Nothing\",\n                    \"value\": \"option3\"\n                  }\n                ],\n                  \"defaultVal\":configJson.syncRulesDeals.subPaused\n              },\n              {  \n                \"dispName\":\"... subscription is <b>resumed</b>\",\n                \"req\":\"false\",\n                \"type\":\"DROPDOWN_DYNAMIC\",\n                \"id\":\"subResumed\",\n                \"isDynamic\":\"true\",\n                \"request\":{\n                  \"type\":\"ON_CHANGE_FETCH_INPUT\",\n                  \"apiEndPoint\":{\n                    \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                    \"type\":\"GET\",\n                    \"headers\":{\n                      \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                      \"Elements-Formula-Instance-Id\":getPipelineStagesInstance\n                    },\n                    \"input\":{\n                      \"card\":\"subscription\"\n                    }\n                  }\n                },\n                \"dropDownItemsList\":[\n                  {\n                    \"disp\": \"Update existing deal\",\n                    \"value\": \"option2\",\n                    \"helptext\": \"Last Created Open deal will be updated in Pipedrive. <a href='' target='blank'>Learn More</a>\"\n                  },\n                  {\n                    \"disp\": \"Do Nothing\",\n                    \"value\": \"option3\"\n                  }\n                ],\n                  \"defaultVal\":configJson.syncRulesDeals.subResumed\n              },\n              {  \n                \"dispName\":\"... subscription is <b>cancelled</b>\",\n                \"req\":\"false\",\n                \"type\":\"DROPDOWN_DYNAMIC\",\n                \"id\":\"subCancelled\",\n                \"isDynamic\":\"true\",\n                \"request\":{\n                  \"type\":\"ON_CHANGE_FETCH_INPUT\",\n                  \"apiEndPoint\":{\n                    \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                    \"type\":\"GET\",\n                    \"headers\":{\n                      \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                      \"Elements-Formula-Instance-Id\":getPipelineStagesInstance\n                    },\n                    \"input\":{\n                      \"card\":\"subscription\"\n                    }\n                  }\n                },\n                \"dropDownItemsList\":[\n                  {\n                    \"disp\": \"Update existing deal\",\n                    \"value\": \"option2\",\n                    \"helptext\": \"Last Created Open deal will be updated in Pipedrive. <a href='' target='blank'>Learn More</a>\"\n                  },\n                  {\n                    \"disp\": \"Do Nothing\",\n                    \"value\": \"option3\"\n                  }\n                ],\n                  \"defaultVal\":configJson.syncRulesDeals.subResumed.subCancelled\n              },\n              {  \n                \"dispName\":\"... subscription is <b>reactivated</b>\",\n                \"req\":\"false\",\n                \"type\":\"DROPDOWN_DYNAMIC\",\n                \"id\":\"subReactivated\",\n                \"isDynamic\":\"true\",\n                \"request\":{\n                  \"type\":\"ON_CHANGE_FETCH_INPUT\",\n                  \"apiEndPoint\":{\n                    \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                    \"type\":\"GET\",\n                    \"headers\":{\n                      \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                      \"Elements-Formula-Instance-Id\":getPipelineStagesInstance\n                    },\n                    \"input\":{\n                      \"card\":\"subscription\"\n                    }\n                  }\n                },\n                \"dropDownItemsList\":[\n                  {\n                    \"disp\": \"Create a deal\",\n                    \"value\": \"option1\"\n                  },\n                  {\n                    \"disp\": \"Update existing deal\",\n                    \"value\": \"option2\",\n                    \"helptext\": \"Last Created Open deal will be updated in Pipedrive. <a href='' target='blank'>Learn More</a>\"\n                  },\n                  {\n                    \"disp\": \"Do Nothing\",\n                    \"value\": \"option3\"\n                  }\n                ],\n                  \"defaultVal\":configJson.syncRulesDeals.subResumed.subReactivated\n              }\n            ]\n        },\n          \"id\" : \"testdynamic\",\n          \"isCardDone\": \"true\"\n      },\n      {\n        \"card\": {\n        \"type\" : \"EMPTY_BACKGROUND\",\n        \"heading\":\"Deal Settings For Customer One-Time Invoices\",\n          \"contents\":[\n            \"Configure how you'd like to handle when one-time invoices are created in Chargebee. <a href=\\\"https://www.chargebee.com\\\" target=\\\"blank\\\">Learn More</a>\"\n            ]\n        },\n        \"isCardDone\": \"true\"\n      },\n      {\n        \"card\": {\n            \"heading\": \"Choose how you'd like to handle deals in Pipedrive when\",\n            \"type\" : \"DYNAMIC_INPUT\",\n            \"params\": [\n              {  \n                \"dispName\":\"... invoice is <b>created</b>\",\n                \"req\":\"false\",\n                \"type\":\"DROPDOWN_DYNAMIC\",\n                \"id\":\"invCreated\",\n                \"isDynamic\":\"true\",\n                \"request\":{\n                  \"type\":\"ON_CHANGE_FETCH_INPUT\",\n                  \"apiEndPoint\":{\n                    \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                    \"type\":\"GET\",\n                    \"headers\":{\n                      \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                      \"Elements-Formula-Instance-Id\":getPipelineStagesInstance\n                    },\n                    \"input\":{\n                      \"card\":\"invoice\"\n                    }\n                  }\n                },\n                \"dropDownItemsList\":[\n                  {\n                    \"disp\": \"Create a deal\",\n                    \"value\": \"option1\"\n                  },\n                  {\n                    \"disp\": \"Update existing deal\",\n                    \"value\": \"option2\",\n                    \"helptext\": \"Last Created Open deal will be updated in Pipedrive. <a href='' target='blank'>Learn More</a>\"\n                  },\n                  {\n                    \"disp\": \"Do Nothing\",\n                    \"value\": \"option3\"\n                  }\n                ],\n                  \"defaultVal\":configJson.syncRulesDeals.invCreated\n              },\n              {  \n                \"dispName\":\"... invoice is <b>deleted</b>\",\n                \"req\":\"false\",\n                \"type\":\"DROPDOWN_DYNAMIC\",\n                \"id\":\"invDeleted\",\n                \"isDynamic\":\"true\",\n                \"request\":{\n                  \"type\":\"ON_CHANGE_FETCH_INPUT\",\n                  \"apiEndPoint\":{\n                    \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                    \"type\":\"GET\",\n                    \"headers\":{\n                      \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                      \"Elements-Formula-Instance-Id\":getPipelineStagesInstance\n                    },\n                    \"input\":{\n                      \"card\":\"invoice\"\n                    }\n                  }\n                },\n                \"dropDownItemsList\":[\n                  {\n                    \"disp\": \"Update existing deal\",\n                    \"value\": \"option2\",\n                    \"helptext\": \"Last Created Open deal will be updated in Pipedrive. <a href='' target='blank'>Learn More</a>\"\n                  },\n                  {\n                    \"disp\": \"Do Nothing\",\n                    \"value\": \"option3\"\n                  }\n                ],\n                  \"defaultVal\":configJson.syncRulesDeals.invDeleted\n              },\n              {  \n                \"dispName\":\"... invoice is <b>paid</b>\",\n                \"req\":\"false\",\n                \"type\":\"DROPDOWN_DYNAMIC\",\n                \"id\":\"invPaid\",\n                \"isDynamic\":\"true\",\n                \"request\":{\n                  \"type\":\"ON_CHANGE_FETCH_INPUT\",\n                  \"apiEndPoint\":{\n                    \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                    \"type\":\"GET\",\n                    \"headers\":{\n                      \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                      \"Elements-Formula-Instance-Id\":getPipelineStagesInstance\n                    },\n                    \"input\":{\n                      \"card\":\"invoice\"\n                    }\n                  }\n                },\n                \"dropDownItemsList\":[\n                  {\n                    \"disp\": \"Update existing deal\",\n                    \"value\": \"option2\",\n                    \"helptext\": \"Last Created Open deal will be updated in Pipedrive. <a href='' target='blank'>Learn More</a>\"\n                  },\n                  {\n                    \"disp\": \"Do Nothing\",\n                    \"value\": \"option3\"\n                  }\n                ],\n                  \"defaultVal\":configJson.syncRulesDeals.invPaid\n              },\n              {  \n                \"dispName\":\"... invoice is <b>voided</b>\",\n                \"req\":\"false\",\n                \"type\":\"DROPDOWN_DYNAMIC\",\n                \"id\":\"invVoided\",\n                \"isDynamic\":\"true\",\n                \"request\":{\n                  \"type\":\"ON_CHANGE_FETCH_INPUT\",\n                  \"apiEndPoint\":{\n                    \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                    \"type\":\"GET\",\n                    \"headers\":{\n                      \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                      \"Elements-Formula-Instance-Id\":getPipelineStagesInstance\n                    },\n                    \"input\":{\n                      \"card\":\"invoice\"\n                    }\n                  }\n                },\n                \"dropDownItemsList\":[\n                  {\n                    \"disp\": \"Update existing deal\",\n                    \"value\": \"option2\",\n                    \"helptext\": \"Last Created Open deal will be updated in Pipedrive. <a href='' target='blank'>Learn More</a>\"\n                  },\n                  {\n                    \"disp\": \"Do Nothing\",\n                    \"value\": \"option3\"\n                  }\n                ],\n                  \"defaultVal\":configJson.syncRulesDeals.invVoided\n              },\n              {       \n              \"dispName\":\"Update deal value with invoice amount\",\n                \"desc\":\"Disable if you don't want Chargebee to deal value in Pipedrive with invoice amount.\",\n                \"req\":\"false\",\n                \"type\":\"TOGGLE\",\n                \"id\":\"updateDealValueWithInvoice\",\n                \"defaultVal\":configJson.syncRulesDeals.updateDealValueWithInvoice\n              },\n              {       \n              \"dispName\":\"Allow Chargebee to add notes to deals\",\n                \"desc\":\"Enable if you want Chargebee to add notes to deals when changes are made to deal stage or deal value. <a href=\\\"\\\" target=\\\"blank\\\">Learn more</a>\",\n                \"req\":\"false\",\n                \"type\":\"TOGGLE\",\n                \"id\":\"addNotesInvoice\",\n                \"subCaption\":\"Example: \\\"Deal worth USD 99 created due to subscription (#12dfgh) creation in Chargebee\\\"\",\n                \"defaultVal\":configJson.syncRulesDeals.addNotesInvoice\n              }\n            ]\n        },\n          \"id\" : \"testdynamic2\",\n          \"isCardDone\": \"true\"\n      },\n      {\n        \"id\": \"mainCard\",\n        \"card\": {\n          \"type\" : \"EMPTY_BACKGROUND\",\n          \"heading\":\"Sync fields from Chargebee to Pipedrive\",\n          \"contents\":[\n            \"Set Rules to sync customer and subscription fields from Chargebee to Pipedrive.\"\n            ],\n            \"message\": {\n                \"message\": (linkSubAttributesToPerson === \"option1\") ? \"We will sync 10 fields from Chargebee to Pipedrive. You can sync more fields by enabling the configuration below. The subscription fields will be synced as attributes to person in Pipedrive.\" : \"We will sync 10 fields from Chargebee to Pipedrive. You can sync more fields by enabling the configuration below.The subscription fields will be synced as attributes of organization in Pipedrive.  \",\n                  \"messageLook\": \"INFO\",\n                      \"button\": {\n                \"display\": \"View Fields\",\n                \"icon\": \"ARROW\",\n                \"url\": \"https://www.chargebee.com/docs/index.html\",\n                \"id\": \"viewFields\",\n                \"type\": \"DIRECT_LINK\",\n                \"newTab\": \"true\"\n            }\n              }\n        },\n        \"isCardDone\": \"true\"\n      },\n      {\n  \t\t\t\"card\": {\n  \t\t\t\t\"type\" : \"TOGGLE_HIDE_INPUT\",\n  \t\t\t\t\"params\": [\n  \t\t\t\t\t{\t\t  \n  \t\t\t\t\t\t\"dispName\":\"Sync more fields from Chargebee to Pipedrive\",\n  \t\t\t\t\t\t\"req\":\"false\",\n  \t\t\t\t\t\t\"type\":\"TOGGLE\",\n  \t\t\t\t\t\t\"id\":\"syncMoreFields\",\n  \t\t\t\t\t\t\"defaultVal\": ((configJson.syncFields.personFields.length > 0) || (configJson.syncFields.subscriptionFields.length > 0)) ? \"true\": \"false\"\n  \t\t\t\t\t},\n  \t\t\t\t\t{\n              \"dispName\": \"Subscription fields\",\n              \"type\": \"MODELBOX_INPUT_FIELDS\",\n              \"id\": \"subscriptionFields\",\n              \"inputFields\": [\n                  {\n                      \"type\": \"SEARCH_CHECK_BOX\",\n                      \"id\": \"subscriptionFieldsSelected\",\n                      \"checkboxes\": [\n                          {\n                              \"type\": \"CHECKBOX\",\n                              \"id\": \"CB_Subscription_ID\",\n                              \"desc\": \"Id\",\n                              \"defaultVal\" : (configJson.syncFields.subscriptionFields.indexOf(\"CB_Subscription_ID\") > -1) ? \"on\" : undefined\n                          },\n                          {\n                              \"type\": \"CHECKBOX\",\n                              \"id\": \"CB_Subscription_Currency\",\n                              \"desc\": \"Currency\",\n                              \"defaultVal\" : (configJson.syncFields.subscriptionFields.indexOf(\"CB_Subscription_Currency\") > -1) ? \"on\" : undefined\n                          },\n                          {\n                              \"type\": \"CHECKBOX\",\n                              \"id\": \"CB_Subscription_Plan_Name\",\n                              \"desc\": \"Plan Name\",\n                              \"defaultVal\" : (configJson.syncFields.subscriptionFields.indexOf(\"CB_Subscription_Plan_Name\") > -1) ? \"on\" : undefined\n                          },\n                          {\n                              \"type\": \"CHECKBOX\",\n                              \"id\": \"CB_Subscription_Status\",\n                              \"desc\": \"Status\",\n                              \"defaultVal\" : (configJson.syncFields.subscriptionFields.indexOf(\"CB_Subscription_Status\") > -1) ? \"on\" : undefined\n                          },\n                          {\n                              \"type\": \"CHECKBOX\",\n                              \"id\": \"CB_Subscription_Created_At\",\n                              \"desc\": \"Created At\",\n                              \"defaultVal\" : (configJson.syncFields.subscriptionFields.indexOf(\"CB_Subscription_Created_At\") > -1) ? \"on\" : undefined\n                          },\n                          {\n                              \"type\": \"CHECKBOX\",\n                              \"id\": \"CB_Subscription_Trial_start\",\n                              \"desc\": \"Trial Start\",\n                              \"defaultVal\" : (configJson.syncFields.subscriptionFields.indexOf(\"CB_Subscription_Trial_start\") > -1) ? \"on\" : undefined\n                          },\n                          {\n                              \"type\": \"CHECKBOX\",\n                              \"id\": \"CB_Subscription_Trial_end\",\n                              \"desc\": \"Trial End\",\n                              \"defaultVal\" : (configJson.syncFields.subscriptionFields.indexOf(\"CB_Subscription_Trial_end\") > -1) ? \"on\" : undefined\n                          },\n                          {\n                              \"type\": \"CHECKBOX\",\n                              \"id\": \"CB_Subscription_Started_At\",\n                              \"desc\": \"Started At\",\n                              \"defaultVal\" : (configJson.syncFields.subscriptionFields.indexOf(\"CB_Subscription_Started_At\") > -1) ? \"on\" : undefined\n                          },\n                          {\n                              \"type\": \"CHECKBOX\",\n                              \"id\": \"CB_Subscription_Activated_At\",\n                              \"desc\": \"Activated At\",\n                              \"defaultVal\" : (configJson.syncFields.subscriptionFields.indexOf(\"CB_Subscription_Activated_At\") > -1) ? \"on\" : undefined\n                          },\n                          {\n                              \"type\": \"CHECKBOX\",\n                              \"id\": \"CB_Subscription_Pause_At\",\n                              \"desc\": \"Pause At\",\n                              \"defaultVal\" : (configJson.syncFields.subscriptionFields.indexOf(\"CB_Subscription_Pause_At\") > -1) ? \"on\" : undefined\n                          },\n                          {\n                              \"type\": \"CHECKBOX\",\n                              \"id\": \"CB_Subscription_Resume_At\",\n                              \"desc\": \"Resume At\",\n                              \"defaultVal\" : (configJson.syncFields.subscriptionFields.indexOf(\"CB_Subscription_Resume_At\") > -1) ? \"on\" : undefined\n                          },\n                          {\n                              \"type\": \"CHECKBOX\",\n                              \"id\": \"CB_Subscription_Next_Billing_At\",\n                              \"desc\": \"Next Billing At\",\n                              \"defaultVal\" : (configJson.syncFields.subscriptionFields.indexOf(\"CB_Subscription_Next_Billing_At\") > -1) ? \"on\" : undefined\n                          },\n                          {\n                              \"type\": \"CHECKBOX\",\n                              \"id\": \"CB_Subscription_Start_At\",\n                              \"desc\": \"Start At\",\n                              \"defaultVal\" : (configJson.syncFields.subscriptionFields.indexOf(\"CB_Subscription_Start_At\") > -1) ? \"on\" : undefined\n                          },\n                          {\n                              \"type\": \"CHECKBOX\",\n                              \"id\": \"CB_Subscription_Cancelled_At\",\n                              \"desc\": \"Cancelled At\",\n                              \"defaultVal\" : (configJson.syncFields.subscriptionFields.indexOf(\"CB_Subscription_Cancelled_At\") > -1) ? \"on\" : undefined\n                          },\n                          {\n                              \"type\": \"CHECKBOX\",\n                              \"id\": \"CB_Subscription_Cancel_Reason\",\n                              \"desc\": \"Cancel Reason\",\n                              \"defaultVal\" : (configJson.syncFields.subscriptionFields.indexOf(\"CB_Subscription_Cancel_Reason\") > -1) ? \"on\" : undefined\n                          },\n                          {\n                              \"type\": \"CHECKBOX\",\n                              \"id\": \"CB_Subscription_Current_term_start\",\n                              \"desc\": \"Current Term Start\",\n                              \"defaultVal\" : (configJson.syncFields.subscriptionFields.indexOf(\"CB_Subscription_Current_term_start\") > -1) ? \"on\" : undefined\n                          },\n                          {\n                              \"type\": \"CHECKBOX\",\n                              \"id\": \"CB_Subscription_Current_term_end\",\n                              \"desc\": \"Current Term End\",\n                              \"defaultVal\" : (configJson.syncFields.subscriptionFields.indexOf(\"CB_Subscription_Current_term_end\") > -1) ? \"on\" : undefined\n                          },\n                          {\n                              \"type\": \"CHECKBOX\",\n                              \"id\": \"CB_Subscription_MRR\",\n                              \"desc\": \"MRR\",\n                              \"defaultVal\" : (configJson.syncFields.subscriptionFields.indexOf(\"CB_Subscription_MRR\") > -1) ? \"on\" : undefined\n                          },\n                          {\n                              \"type\": \"CHECKBOX\",\n                              \"id\": \"CB_Subscription_CMRR\",\n                              \"desc\": \"CMRR\",\n                              \"defaultVal\" : (configJson.syncFields.subscriptionFields.indexOf(\"CB_Subscription_CMRR\") > -1) ? \"on\" : undefined\n                          },\n                          {\n                              \"type\": \"CHECKBOX\",\n                              \"id\": \"CB_Gift_Subscription\",\n                              \"desc\": \"Is Gift\",\n                              \"defaultVal\" : (configJson.syncFields.subscriptionFields.indexOf(\"CB_Gift_Subscription\") > -1) ? \"on\" : undefined\n                          }\n                      ]\n                  }\n              ]\n          },\n          {\n              \"dispName\": \"Customer fields\",\n              \"type\": \"MODELBOX_INPUT_FIELDS\",\n              \"id\": \"customerFields\",\n              \"inputFields\": [\n                  {\n                      \"type\": \"SEARCH_CHECK_BOX\",\n                      \"id\": \"customerFieldsSelected\",\n                      \"checkboxes\": [\n                          {\n                              \"type\": \"CHECKBOX\",\n                              \"id\": \"CB_Customer_Auto Collection\",\n                              \"desc\": \"Auto Collection\",\n                              \"defaultVal\" : (configJson.syncFields.personFields.indexOf(\"CB_Customer_Auto\") > -1) ? \"on\" : undefined\n                          },\n                          {\n                              \"type\": \"CHECKBOX\",\n                              \"id\": \"CB_Customer_Locale\",\n                              \"desc\": \"Customer Locale\",\n                              \"defaultVal\" : (configJson.syncFields.personFields.indexOf(\"CB_Customer_Locale\") > -1) ? \"on\" : undefined\n                          },\n                          {\n                              \"type\": \"CHECKBOX\",\n                              \"id\": \"CB_Customer_Total_Due_Amount\",\n                              \"desc\": \"Total Due Amount\",\n                              \"defaultVal\" : (configJson.syncFields.personFields.indexOf(\"CB_Customer_Total_Due_Amount\") > -1) ? \"on\" : undefined\n                          }\n                      ]\n                  }\n              ]\n          }\n\t\t\t\t]\n\t\t\t},\n\t\t\t\"id\" : \"check4\"\n\t\t}\n    ],\n   \"save\":{\n      \t\"id\":\"save\",\n      \t\"display\" : \"Save\",\n      \t\"icon\" : \"ARROW\",\n      \t\"buttonLook\":\"FILLED\",\n      \t\"type\" : \"DIRECT_LINK\",\n      \t\"request\":{\n     \t\t\"type\":\"ON_CLICK_SEND_INPUT\",\n     \t\t\"apiEndPoint\":{\n            \t\"apiUrl\":cloudElementsUrl+\"/pipedrive/saveSyncRules\",\n            \t\"type\":\"POST\",\n            \t\"headers\":{\n               \t\t\"Elements-Formula-Instance-Id\":manageSyncRulesSaveInstance\n            \t},\n            \t\"input\":{\n               \t\t\"id\":\"chargebee\",\n               \t\t\"apiKey\": steps.InputParams.params.input.apiKey,\n               \t\t\"siteName\" : steps.InputParams.params.input.siteName,\n               \t\t\"siteDomain\" : siteDomain,\n               \t\t\"integrationName\": integrationName\n            \t}\n         \t}\n      \t}\n    },\n    \"dismissText\" : \"Dismiss\"\n};\n\n\nif(configJson.syncRulesContacts !== undefined){\n  if(configJson.syncRulesContacts.manageOrganizationInPipedrive === \"true\"){\n    let newParams = [\n       {       \n       \"dispName\":\"Allow Chargebee to create People in Pipedrive\",\n             \"desc\":\"By default, existing people, if any, will be updated with the changes made in Chargebee. Disable if you dont want chargebee to create People in Pipedrive\",\n         \"type\":\"TOGGLE\",\n         \"id\":\"createPeopleInPipedrive\",\n         \"defaultVal\": (configJson.syncRulesContacts !== undefined) ? ((configJson.syncRulesContacts.createPeopleInPipedrive === \"false\") ? false : true) : true,\n         \"isSeperator\":true\n      },\n      {       \n        \"dispName\":\"Allow Chargebee to manage Organization in Pipedrive\",\n        \"desc\":\"By default, Chargebee customers will be synced as People in Pipedrive. Enable if you want to allow Chargebee to add people to Organization, and create and update Organizations in Pipedrive. <a href=\\\"https://www.chargebee.com\\\" target=\\\"blank\\\">Learn More</a>\",\n        \"type\":\"TOGGLE\",\n        \"id\":\"manageOrganizationInPipedrive\",\n        \"defaultVal\": (configJson.syncRulesContacts !== undefined) ? ((configJson.syncRulesContacts.manageOrganizationInPipedrive === \"true\") ? true : false) : false,\n        \"isSeperator\":true,\n        \"isDynamic\":\"true\",\n        \"isDisabled\":true,\n        \"request\":{\n          \"type\":\"ON_CHANGE_FETCH_INPUT\",\n          \"apiEndPoint\":{\n            \"apiUrl\":cloudElementsUrl+\"/pipedrive/getOrganizationSettings\",\n            \"type\":\"GET\",\n            \"headers\":{\n              \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n              \"Elements-Formula-Instance-Id\": getOrganizationSettingsInstance\n            },\n            \"input\":{\n              \"card\":\"subscription\"\n            }\n          }\n        }\n     },\n     {\n         \"dispName\":\"Choose what you'd like to do when a customer is synced to Pipedrive\",\n         \"type\":\"DROPDOWN\",\n         \"id\":\"actionCustomerSyncedToPipedrive\",\n         \"allowedValues\":{\n            \"option1\":\"Group using 'Organization' name\",\n            \"option2\":\"Create a new Organization\"\n         },\n          \"defaultVal\": (configJson.syncRulesContacts !== undefined) ? configJson.syncRulesContacts.actionCustomerSyncedToPipedrive : \"option1\"\n       },\n       {  \n          \"dispName\":\"Choose the contact in Pipedrive you'd like to sync subscription details with\",\n         \"type\":\"DROPDOWN\",\n         \"id\":\"linkSubAttributesToPerson\",\n         \"allowedValues\":{\n            \"option1\":\"People\",\n            \"option2\":\"Organization\"\n         },\n          \"defaultVal\": (configJson.syncRulesContacts !== undefined) ? configJson.syncRulesContacts.linkSubAttributesToPerson : \"option1\"\n       },\n       {       \n          \"dispName\":\"Sync Account Hierarchies from Chargebee to Pipedrive\",\n          \"desc\":\"By default, Chargebee customers will be synced as People in Pipedrive. Enable if you want to allow Chargebee to add people to Organization, and create and update Organizations in Pipedrive.\",\n          \"type\":\"TOGGLE\",\n          \"id\":\"syncAccountHierarchies\",\n          \"defaultVal\": (configJson.syncRulesContacts !== undefined) ? ((configJson.syncRulesContacts.syncAccountHierarchies === \"true\") ? true : false) : false,\n          \"isSeperator\":true\n       },\n       {  \n        \"dispName\":\"When a customer is deleted in Chargebee\",\n         \"type\":\"DROPDOWN_DYNAMIC\",\n         \"id\":\"customerDeletedInCB\",\n         \"dropDownItemsList\":[\n                 {\n                  \"value\":\"option1\",\n                    \"disp\":\"Do Nothing\"\n                 },\n                 {\n                  \"value\":\"option2\",\n                    \"disp\":\"Mark 'Person'as 'Deleted'\"\n                 },\n                 {\n                   \"value\":\"option3\",\n                   \"disp\":\"Mark 'Person' and 'Organization' as 'Deleted'\"\n                 }\n         ],\n          \"defaultVal\": (configJson.syncRulesContacts !== undefined) ? configJson.syncRulesContacts.customerDeletedInCB : \"option2\"\n        }\n    ];\n    card.cards[2].card.params = newParams;\n  }\n}\n\nif(configJson.syncRulesDeals !== undefined){\n  let pipeline;\n  let stage;\n  let newParams = [\n    {  \n      \"dispName\":\"... subscription is <b>created</b>\",\n      \"req\":\"false\",\n      \"id\":\"subCreated\",\n      \"type\":\"DROPDOWN_DYNAMIC\",\n      \"isDynamic\":\"true\",\n      \"request\":{\n        \"type\":\"ON_CHANGE_FETCH_INPUT\",\n        \"apiEndPoint\":{\n          \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n          \"type\":\"GET\",\n          \"headers\":{\n            \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n            \"Elements-Formula-Instance-Id\": getPipelineStagesInstance\n          },\n          \"input\":{\n            \"card\":\"subscription\"\n          }\n        }\n      },\n      \"dropDownItemsList\":[\n          {\n            \"disp\": \"Create a deal\",\n            \"value\": \"option1\"\n          },\n          {\n            \"disp\": \"Update existing deal\",\n            \"value\": \"option2\",\n            \"helptext\": \"Last Created Open deal will be updated in Pipedrive. <a href='' target='blank'>Learn More</a>\"\n          },\n          {\n            \"disp\": \"Do Nothing\",\n            \"value\": \"option3\"\n          }\n        ],\n        \"defaultVal\": configJson.syncRulesDeals.subCreated || \"option3\"\n    },\n    {  \n      \"dispName\":\"... subscription items are <b>updated</b>\",\n      \"req\":\"false\",\n      \"type\":\"DROPDOWN_DYNAMIC\",\n      \"id\":\"subUpdated\",\n      \"isDynamic\":\"true\",\n      \"request\":{\n        \"type\":\"ON_CHANGE_FETCH_INPUT\",\n        \"apiEndPoint\":{\n          \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n          \"type\":\"GET\",\n          \"headers\":{\n            \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n            \"Elements-Formula-Instance-Id\": getPipelineStagesInstance\n          },\n          \"input\":{\n            \"card\":\"subscription\"\n          }\n        }\n      },\n      \"dropDownItemsList\":[\n        {\n          \"disp\": \"Update existing deal\",\n          \"value\": \"option2\",\n          \"helptext\": \"Last Created Open deal will be updated in Pipedrive. <a href='' target='blank'>Learn More</a>\"\n        },\n        {\n          \"disp\": \"Do Nothing\",\n          \"value\": \"option3\"\n        }\n      ],\n        \"defaultVal\": configJson.syncRulesDeals.subUpdated || \"option3\"\n    },\n    {  \n      \"dispName\":\"... subscription is <b>deleted</b>\",\n      \"req\":\"false\",\n      \"type\":\"DROPDOWN_DYNAMIC\",\n      \"id\":\"subDeleted\",\n      \"isDynamic\":\"true\",\n      \"request\":{\n        \"type\":\"ON_CHANGE_FETCH_INPUT\",\n        \"apiEndPoint\":{\n          \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n          \"type\":\"GET\",\n          \"headers\":{\n            \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n            \"Elements-Formula-Instance-Id\": getPipelineStagesInstance\n          },\n          \"input\":{\n            \"card\":\"subscription\"\n          }\n        }\n      },\n      \"dropDownItemsList\":[\n                  {\n                    \"disp\": \"Update existing deal\",\n                    \"value\": \"option2\",\n                    \"helptext\": \"Last Created Open deal will be updated in Pipedrive. <a href='' target='blank'>Learn More</a>\"\n                  },\n                  {\n                    \"disp\": \"Do Nothing\",\n                    \"value\": \"option3\"\n                  }\n      ],\n        \"defaultVal\": configJson.syncRulesDeals.subDeleted || \"option3\"\n    },\n    {  \n      \"dispName\":\"... subscription is <b>paused</b>\",\n      \"req\":\"false\",\n      \"type\":\"DROPDOWN_DYNAMIC\",\n      \"id\":\"subPaused\",\n      \"isDynamic\":\"true\",\n      \"request\":{\n        \"type\":\"ON_CHANGE_FETCH_INPUT\",\n        \"apiEndPoint\":{\n          \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n          \"type\":\"GET\",\n          \"headers\":{\n            \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n            \"Elements-Formula-Instance-Id\": getPipelineStagesInstance\n          },\n          \"input\":{\n            \"card\":\"subscription\"\n          }\n        }\n      },\n      \"dropDownItemsList\":[\n        {\n          \"disp\": \"Update existing deal\",\n          \"value\": \"option2\",\n          \"helptext\": \"Last Created Open deal will be updated in Pipedrive. <a href='' target='blank'>Learn More</a>\"\n        },\n        {\n          \"disp\": \"Do Nothing\",\n          \"value\": \"option3\"\n        }\n      ],\n        \"defaultVal\": configJson.syncRulesDeals.subPaused || \"option3\"\n    },\n    {  \n      \"dispName\":\"... subscription is <b>resumed</b>\",\n      \"req\":\"false\",\n      \"type\":\"DROPDOWN_DYNAMIC\",\n      \"id\":\"subResumed\",\n      \"isDynamic\":\"true\",\n      \"request\":{\n        \"type\":\"ON_CHANGE_FETCH_INPUT\",\n        \"apiEndPoint\":{\n          \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n          \"type\":\"GET\",\n          \"headers\":{\n            \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n            \"Elements-Formula-Instance-Id\": getPipelineStagesInstance\n          },\n          \"input\":{\n            \"card\":\"subscription\"\n          }\n        }\n      },\n      \"dropDownItemsList\":[\n        {\n          \"disp\": \"Update existing deal\",\n          \"value\": \"option2\",\n          \"helptext\": \"Last Created Open deal will be updated in Pipedrive. <a href='' target='blank'>Learn More</a>\"\n        },\n        {\n          \"disp\": \"Do Nothing\",\n          \"value\": \"option3\"\n        }\n      ],\n        \"defaultVal\": configJson.syncRulesDeals.subResumed || \"option3\"\n    },\n    {  \n      \"dispName\":\"... subscription is <b>cancelled</b>\",\n      \"req\":\"false\",\n      \"type\":\"DROPDOWN_DYNAMIC\",\n      \"id\":\"subCancelled\",\n      \"isDynamic\":\"true\",\n      \"request\":{\n        \"type\":\"ON_CHANGE_FETCH_INPUT\",\n        \"apiEndPoint\":{\n          \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n          \"type\":\"GET\",\n          \"headers\":{\n            \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n            \"Elements-Formula-Instance-Id\": getPipelineStagesInstance\n          },\n          \"input\":{\n            \"card\":\"subscription\"\n          }\n        }\n      },\n      \"dropDownItemsList\":[\n        {\n          \"disp\": \"Update existing deal\",\n          \"value\": \"option2\",\n          \"helptext\": \"Last Created Open deal will be updated in Pipedrive. <a href='' target='blank'>Learn More</a>\"\n        },\n        {\n          \"disp\": \"Do Nothing\",\n          \"value\": \"option3\"\n        }\n      ],\n        \"defaultVal\": configJson.syncRulesDeals.subCancelled || \"option3\"\n    },\n    {  \n      \"dispName\":\"... subscription is <b>reactivated</b>\",\n      \"req\":\"false\",\n      \"type\":\"DROPDOWN_DYNAMIC\",\n      \"id\":\"subReactivated\",\n      \"isDynamic\":\"true\",\n      \"isSeperator\":true,\n      \"request\":{\n        \"type\":\"ON_CHANGE_FETCH_INPUT\",\n        \"apiEndPoint\":{\n          \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n          \"type\":\"GET\",\n          \"headers\":{\n            \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n            \"Elements-Formula-Instance-Id\": getPipelineStagesInstance\n          },\n          \"input\":{\n            \"card\":\"subscription\"\n          }\n        }\n      },\n      \"dropDownItemsList\":[\n        {\n          \"disp\": \"Create a deal\",\n          \"value\": \"option1\"\n        },\n        {\n          \"disp\": \"Update existing deal\",\n          \"value\": \"option2\",\n          \"helptext\": \"Last Created Open deal will be updated in Pipedrive. <a href='' target='blank'>Learn More</a>\"\n        },\n        {\n          \"disp\": \"Do Nothing\",\n          \"value\": \"option3\"\n        }\n      ],\n        \"defaultVal\": configJson.syncRulesDeals.subReactivated || \"option3\"\n    },\n    {  \n      \"dispName\":\"Choose how you'd like to <b>update deal value</b> in Pipedrive\",\n      \"req\":\"false\",\n      \"type\":\"DROPDOWN\",\n      \"id\":\"howToUpdateDealValue\",\n      \"allowedValues\":{\n          \"option1\": \"Use Recurring Items Total\",\n          \"option2\": \"Use invoice amount\",\n          // \"option3\": \"Use Subscription MRR\",\n          \"option4\": \"Don't Update Deal Value\",\n      },\n        \"defaultVal\": configJson.syncRulesDeals.howToUpdateDealValue || \"option2\"\n    },\n    {       \n    \"dispName\":\"Allow Chargebee to add notes to deals\",\n      \"desc\":\"Enable if you want Chargebee to add notes to deals when changes are made to deal stage or deal value.<a href=\\\"\\\" target=\\\"blank\\\">Learn more</a>\",\n      \"req\":\"false\",\n      \"type\":\"TOGGLE\",\n      \"id\":\"addNotesSubscription\",\n      \"subCaption\":\"Example: \\\"Deal worth USD 99 created due to subscription (#12dfgh) creation in Chargebee\\\"\",\n      \"defaultVal\": ((configJson.syncRulesDeals.addNotesSubscription === \"true\") ? true : false) || false\n    }\n  ];\n  \n  // //IF ALL STEPS ARE DONOTHING\n  if((configJson.syncRulesDeals.subCreated === \"option3\") && (configJson.syncRulesDeals.subUpdated === \"option3\") && (configJson.syncRulesDeals.subDeleted === \"option3\") && (configJson.syncRulesDeals.subPaused === \"option3\") && (configJson.syncRulesDeals.subResumed === \"option3\") && (configJson.syncRulesDeals.subCancelled === \"option3\") && (configJson.syncRulesDeals.subReactivated === \"option3\")){\n    for(var i=0; i < newParams.length; i++){\n      if(newParams[i]['id'] === \"howToUpdateDealValue\"){\n        newParams.splice(i);\n        if(newParams[i-1]['isSeperator'] !== undefined){\n          newParams[i-1]['isSeperator'] = undefined;\n        }\n      }\n    }\n  }\n  //   \n  \n  for(var i=0; i < newParams.length; i++){\n    if((newParams[i]['id'] === \"subCreated\") && (configJson.syncRulesDeals.subCreated !== \"option3\")){\n      pipeline = {\n        \"dispName\":\"<p style='padding-left: 10px;'>- Choose the pipeline you'd like to add this deal to </p>\",\n        \"req\":\"false\",\n        \"id\":\"subCreatedPipeline\",\n        \"type\":\"DROPDOWN_DYNAMIC\",\n        \"dropDownItemsList\": pipelineList,\n        \"isDynamic\":\"true\",\n        \"request\":{\n            \"type\":\"ON_CHANGE_FETCH_INPUT\",\n            \"apiEndPoint\":{\n                \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                \"type\":\"GET\",\n                \"headers\":{\n                    \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                    \"Elements-Formula-Instance-Id\": getPipelineStagesInstance\n                },\n                \"input\":{\n                    \"card\":\"subscription\",\n                    \"selectedPipeline\" : \"subCreatedPipeline\"\n                }\n            }\n        },\n        \"defaultVal\": configJson.syncRulesDeals.subCreatedPipeline || \"1\"\n      };\n      stage = {\n          \"dispName\":\"<p style='padding-left: 10px;'>- Choose the stage you'd like to add this deal to\",\n          \"req\":\"false\",\n          \"type\":\"DROPDOWN_DYNAMIC\",\n          \"id\":\"subCreatedStage\",\n          \"request\":{\n              \"type\":\"ON_CHANGE_FETCH_INPUT\",\n              \"apiEndPoint\":{\n                  \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                  \"type\":\"GET\",\n                  \"headers\":{\n                      \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                      \"Elements-Formula-Instance-Id\": getPipelineStagesInstance\n                  },\n                  \"input\":{\n                      \"id\": \"chargebee\"\n                  }\n              }\n          },\n          \"dropDownItemsList\": stagesList[(configJson.syncRulesDeals.subCreatedPipeline)-1] || stagesList[0],\n          \"defaultVal\": configJson.syncRulesDeals.subCreatedStage\n      };\n      newParams.splice(i+1,0,pipeline);\n      newParams.splice(i+2,0,stage);\n    }\n    if((newParams[i]['id'] === \"subUpdated\") && (configJson.syncRulesDeals.subUpdated !== \"option3\")){\n      pipeline = {\n        \"dispName\":\"<p style='padding-left: 10px;'>- Choose the pipeline you'd like to add this deal to </p>\",\n        \"req\":\"false\",\n        \"id\":\"subUpdatedPipeline\",\n        \"type\":\"DROPDOWN_DYNAMIC\",\n        \"dropDownItemsList\": pipelineList,\n        \"isDynamic\":\"true\",\n        \"request\":{\n            \"type\":\"ON_CHANGE_FETCH_INPUT\",\n            \"apiEndPoint\":{\n                \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                \"type\":\"GET\",\n                \"headers\":{\n                    \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                    \"Elements-Formula-Instance-Id\": getPipelineStagesInstance\n                },\n                \"input\":{\n                    \"card\":\"subscription\",\n                    \"selectedPipeline\" : \"subUpdatedPipeline\"\n                }\n            }\n        },\n        \"defaultVal\": configJson.syncRulesDeals.subUpdatedPipeline || \"1\"\n      };\n      stage = {\n          \"dispName\":\"<p style='padding-left: 10px;'>- Choose the stage you'd like to add this deal to\",\n          \"req\":\"false\",\n          \"type\":\"DROPDOWN_DYNAMIC\",\n          \"id\":\"subUpdatedStage\",\n          \"request\":{\n              \"type\":\"ON_CHANGE_FETCH_INPUT\",\n              \"apiEndPoint\":{\n                  \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                  \"type\":\"GET\",\n                  \"headers\":{\n                      \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                      \"Elements-Formula-Instance-Id\": getPipelineStagesInstance\n                  },\n                  \"input\":{\n                      \"id\": \"chargebee\"\n                  }\n              }\n          },\n          \"dropDownItemsList\": stagesList[(configJson.syncRulesDeals.subUpdatedPipeline)-1] || stagesList[0],\n          \"defaultVal\": configJson.syncRulesDeals.subUpdatedStage\n      };\n      newParams.splice(i+1,0,pipeline);\n      newParams.splice(i+2,0,stage);\n    }\n    if((newParams[i]['id'] === \"subDeleted\") && (configJson.syncRulesDeals.subDeleted !== \"option3\")){\n      pipeline = {\n        \"dispName\":\"<p style='padding-left: 10px;'>- Choose the pipeline you'd like to add this deal to </p>\",\n        \"req\":\"false\",\n        \"id\":\"subDeletedPipeline\",\n        \"type\":\"DROPDOWN_DYNAMIC\",\n        \"dropDownItemsList\": pipelineList,\n        \"isDynamic\":\"true\",\n        \"request\":{\n            \"type\":\"ON_CHANGE_FETCH_INPUT\",\n            \"apiEndPoint\":{\n                \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                \"type\":\"GET\",\n                \"headers\":{\n                    \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                    \"Elements-Formula-Instance-Id\": getPipelineStagesInstance\n                },\n                \"input\":{\n                    \"card\":\"subscription\",\n                    \"selectedPipeline\" : \"subDeletedPipeline\"\n                }\n            }\n        },\n        \"defaultVal\": configJson.syncRulesDeals.subDeletedPipeline || \"1\"\n      };\n      stage = {\n          \"dispName\":\"<p style='padding-left: 10px;'>- Choose the stage you'd like to add this deal to\",\n          \"req\":\"false\",\n          \"type\":\"DROPDOWN_DYNAMIC\",\n          \"id\":\"subDeletedStage\",\n          \"request\":{\n              \"type\":\"ON_CHANGE_FETCH_INPUT\",\n              \"apiEndPoint\":{\n                  \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                  \"type\":\"GET\",\n                  \"headers\":{\n                      \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                      \"Elements-Formula-Instance-Id\": getPipelineStagesInstance\n                  },\n                  \"input\":{\n                      \"id\": \"chargebee\"\n                  }\n              }\n          },\n          \"dropDownItemsList\": stagesList[(configJson.syncRulesDeals.subDeletedPipeline)-1] || stagesList[0],\n          \"defaultVal\": configJson.syncRulesDeals.subDeletedStage\n      };\n      newParams.splice(i+1,0,pipeline);\n      newParams.splice(i+2,0,stage);\n    }\n    if((newParams[i]['id'] === \"subPaused\") && (configJson.syncRulesDeals.subPaused !== \"option3\")){\n      pipeline = {\n        \"dispName\":\"<p style='padding-left: 10px;'>- Choose the pipeline you'd like to add this deal to </p>\",\n        \"req\":\"false\",\n        \"id\":\"subPausedPipeline\",\n        \"type\":\"DROPDOWN_DYNAMIC\",\n        \"dropDownItemsList\": pipelineList,\n        \"isDynamic\":\"true\",\n        \"request\":{\n            \"type\":\"ON_CHANGE_FETCH_INPUT\",\n            \"apiEndPoint\":{\n                \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                \"type\":\"GET\",\n                \"headers\":{\n                    \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                    \"Elements-Formula-Instance-Id\": getPipelineStagesInstance\n                },\n                \"input\":{\n                    \"card\":\"subscription\",\n                    \"selectedPipeline\" : \"subPausedPipeline\"\n                }\n            }\n        },\n        \"defaultVal\": configJson.syncRulesDeals.subPausedPipeline || \"1\"\n      };\n      stage = {\n          \"dispName\":\"<p style='padding-left: 10px;'>- Choose the stage you'd like to add this deal to\",\n          \"req\":\"false\",\n          \"type\":\"DROPDOWN_DYNAMIC\",\n          \"id\":\"subPausedStage\",\n          \"request\":{\n              \"type\":\"ON_CHANGE_FETCH_INPUT\",\n              \"apiEndPoint\":{\n                  \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                  \"type\":\"GET\",\n                  \"headers\":{\n                      \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                      \"Elements-Formula-Instance-Id\": getPipelineStagesInstance\n                  },\n                  \"input\":{\n                      \"id\": \"chargebee\"\n                  }\n              }\n          },\n          \"dropDownItemsList\": stagesList[(configJson.syncRulesDeals.subPausedPipeline)-1] || stagesList[0],\n          \"defaultVal\": configJson.syncRulesDeals.subPausedStage\n      };\n      newParams.splice(i+1,0,pipeline);\n      newParams.splice(i+2,0,stage);\n    }\n    if((newParams[i]['id'] === \"subResumed\") && (configJson.syncRulesDeals.subResumed !== \"option3\")){\n      pipeline = {\n        \"dispName\":\"<p style='padding-left: 10px;'>- Choose the pipeline you'd like to add this deal to </p>\",\n        \"req\":\"false\",\n        \"id\":\"subResumedPipeline\",\n        \"type\":\"DROPDOWN_DYNAMIC\",\n        \"dropDownItemsList\": pipelineList,\n        \"isDynamic\":\"true\",\n        \"request\":{\n            \"type\":\"ON_CHANGE_FETCH_INPUT\",\n            \"apiEndPoint\":{\n                \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                \"type\":\"GET\",\n                \"headers\":{\n                    \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                    \"Elements-Formula-Instance-Id\": getPipelineStagesInstance\n                },\n                \"input\":{\n                    \"card\":\"subscription\",\n                    \"selectedPipeline\" : \"subResumedPipeline\"\n                }\n            }\n        },\n        \"defaultVal\": configJson.syncRulesDeals.subResumedPipeline || \"1\"\n      };\n      stage = {\n          \"dispName\":\"<p style='padding-left: 10px;'>- Choose the stage you'd like to add this deal to\",\n          \"req\":\"false\",\n          \"type\":\"DROPDOWN_DYNAMIC\",\n          \"id\":\"subResumedStage\",\n          \"request\":{\n              \"type\":\"ON_CHANGE_FETCH_INPUT\",\n              \"apiEndPoint\":{\n                  \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                  \"type\":\"GET\",\n                  \"headers\":{\n                      \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                      \"Elements-Formula-Instance-Id\": getPipelineStagesInstance\n                  },\n                  \"input\":{\n                      \"id\": \"chargebee\"\n                  }\n              }\n          },\n          \"dropDownItemsList\": stagesList[(configJson.syncRulesDeals.subResumedPipeline)-1] || stagesList[0],\n          \"defaultVal\": configJson.syncRulesDeals.subResumedStage\n      };\n      newParams.splice(i+1,0,pipeline);\n      newParams.splice(i+2,0,stage);\n    }\n    if((newParams[i]['id'] === \"subCancelled\") && (configJson.syncRulesDeals.subCancelled !== \"option3\")){\n      pipeline = {\n        \"dispName\":\"<p style='padding-left: 10px;'>- Choose the pipeline you'd like to add this deal to </p>\",\n        \"req\":\"false\",\n        \"id\":\"subCancelledPipeline\",\n        \"type\":\"DROPDOWN_DYNAMIC\",\n        \"dropDownItemsList\": pipelineList,\n        \"isDynamic\":\"true\",\n        \"request\":{\n            \"type\":\"ON_CHANGE_FETCH_INPUT\",\n            \"apiEndPoint\":{\n                \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                \"type\":\"GET\",\n                \"headers\":{\n                    \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                    \"Elements-Formula-Instance-Id\": getPipelineStagesInstance\n                },\n                \"input\":{\n                    \"card\":\"subscription\",\n                    \"selectedPipeline\" : \"subCancelledPipeline\"\n                }\n            }\n        },\n        \"defaultVal\": configJson.syncRulesDeals.subCancelledPipeline || \"1\"\n      };\n      stage = {\n          \"dispName\":\"<p style='padding-left: 10px;'>- Choose the stage you'd like to add this deal to\",\n          \"req\":\"false\",\n          \"type\":\"DROPDOWN_DYNAMIC\",\n          \"id\":\"subCancelledStage\",\n          \"request\":{\n              \"type\":\"ON_CHANGE_FETCH_INPUT\",\n              \"apiEndPoint\":{\n                  \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                  \"type\":\"GET\",\n                  \"headers\":{\n                      \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                      \"Elements-Formula-Instance-Id\": getPipelineStagesInstance\n                  },\n                  \"input\":{\n                      \"id\": \"chargebee\"\n                  }\n              }\n          },\n          \"dropDownItemsList\": stagesList[(configJson.syncRulesDeals.subCancelledPipeline)-1] || stagesList[0],\n          \"defaultVal\": configJson.syncRulesDeals.subCancelledStage\n      };\n      newParams.splice(i+1,0,pipeline);\n      newParams.splice(i+2,0,stage);\n    }\n    if((newParams[i]['id'] === \"subReactivated\") && (configJson.syncRulesDeals.subReactivated !== \"option3\")){\n      pipeline = {\n        \"dispName\":\"<p style='padding-left: 10px;'>- Choose the pipeline you'd like to add this deal to </p>\",\n        \"req\":\"false\",\n        \"id\":\"subReactivatedPipeline\",\n        \"type\":\"DROPDOWN_DYNAMIC\",\n        \"dropDownItemsList\": pipelineList,\n        \"isDynamic\":\"true\",\n        \"request\":{\n            \"type\":\"ON_CHANGE_FETCH_INPUT\",\n            \"apiEndPoint\":{\n                \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                \"type\":\"GET\",\n                \"headers\":{\n                    \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                    \"Elements-Formula-Instance-Id\": getPipelineStagesInstance\n                },\n                \"input\":{\n                    \"card\":\"subscription\",\n                    \"selectedPipeline\" : \"subReactivatedPipeline\"\n                }\n            }\n        },\n        \"defaultVal\": configJson.syncRulesDeals.subReactivatedPipeline || \"1\"\n      };\n      stage = {\n          \"dispName\":\"<p style='padding-left: 10px;'>- Choose the stage you'd like to add this deal to\",\n          \"req\":\"false\",\n          \"type\":\"DROPDOWN_DYNAMIC\",\n          \"isSeperator\":true,\n          \"id\":\"subReactivatedStage\",\n          \"request\":{\n              \"type\":\"ON_CHANGE_FETCH_INPUT\",\n              \"apiEndPoint\":{\n                  \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                  \"type\":\"GET\",\n                  \"headers\":{\n                      \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                      \"Elements-Formula-Instance-Id\": getPipelineStagesInstance\n                  },\n                  \"input\":{\n                      \"id\": \"chargebee\"\n                  }\n              }\n          },\n          \"dropDownItemsList\": stagesList[(configJson.syncRulesDeals.subReactivatedPipeline)-1] || stagesList[0],\n          \"defaultVal\": configJson.syncRulesDeals.subReactivatedStage\n      };\n      newParams[i]['isSeperator'] = undefined;\n      newParams.splice(i+1,0,pipeline);\n      newParams.splice(i+2,0,stage);\n    }\n  }\n  card.cards[5].card.params = newParams;\n  let newParams_2 = [\n          {  \n            \"dispName\":\"... invoice is <b>created</b>\",\n            \"req\":\"false\",\n            \"type\":\"DROPDOWN_DYNAMIC\",\n            \"id\":\"invCreated\",\n            \"isDynamic\":\"true\",\n            \"request\":{\n              \"type\":\"ON_CHANGE_FETCH_INPUT\",\n              \"apiEndPoint\":{\n                \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                \"type\":\"GET\",\n                \"headers\":{\n                  \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                  \"Elements-Formula-Instance-Id\": getPipelineStagesInstance\n                },\n                \"input\":{\n                  \"card\":\"invoice\"\n                }\n              }\n            },\n            \"dropDownItemsList\":[\n                  {\n                    \"disp\": \"Create a deal\",\n                    \"value\": \"option1\"\n                  },\n                  {\n                    \"disp\": \"Update existing deal\",\n                    \"value\": \"option2\",\n                    \"helptext\": \"Last Created Open deal will be updated in Pipedrive. <a href='' target='blank'>Learn More</a>\"\n                  },\n                  {\n                    \"disp\": \"Do Nothing\",\n                    \"value\": \"option3\"\n                  }\n              ],\n              \"defaultVal\": configJson.syncRulesDeals.invCreated || \"option3\"\n          },\n          {  \n            \"dispName\":\"... invoice is <b>deleted</b>\",\n            \"req\":\"false\",\n            \"type\":\"DROPDOWN_DYNAMIC\",\n            \"id\":\"invDeleted\",\n            \"isDynamic\":\"true\",\n            \"request\":{\n              \"type\":\"ON_CHANGE_FETCH_INPUT\",\n              \"apiEndPoint\":{\n                \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                \"type\":\"GET\",\n                \"headers\":{\n                  \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                  \"Elements-Formula-Instance-Id\": getPipelineStagesInstance\n                },\n                \"input\":{\n                  \"card\":\"invoice\"\n                }\n              }\n            },\n            \"dropDownItemsList\":[\n                  {\n                    \"disp\": \"Update existing deal\",\n                    \"value\": \"option2\",\n                    \"helptext\": \"Last Created Open deal will be updated in Pipedrive. <a href='' target='blank'>Learn More</a>\"\n                  },\n                  {\n                    \"disp\": \"Do Nothing\",\n                    \"value\": \"option3\"\n                  }\n              ],\n              \"defaultVal\": configJson.syncRulesDeals.invDeleted || \"option3\"\n          },\n          {  \n            \"dispName\":\"... invoice is <b>paid</b>\",\n            \"req\":\"false\",\n            \"type\":\"DROPDOWN_DYNAMIC\",\n            \"id\":\"invPaid\",\n            \"isDynamic\":\"true\",\n            \"request\":{\n              \"type\":\"ON_CHANGE_FETCH_INPUT\",\n              \"apiEndPoint\":{\n                \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                \"type\":\"GET\",\n                \"headers\":{\n                  \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                  \"Elements-Formula-Instance-Id\": getPipelineStagesInstance\n                },\n                \"input\":{\n                  \"card\":\"invoice\"\n                }\n              }\n            },\n            \"dropDownItemsList\":[\n                  {\n                    \"disp\": \"Create a deal\",\n                    \"value\": \"option1\"\n                  },\n                  {\n                    \"disp\": \"Update existing deal\",\n                    \"value\": \"option2\",\n                    \"helptext\": \"Last Created Open deal will be updated in Pipedrive. <a href='' target='blank'>Learn More</a>\"\n                  },\n                  {\n                    \"disp\": \"Do Nothing\",\n                    \"value\": \"option3\"\n                  }\n              ],\n              \"defaultVal\": configJson.syncRulesDeals.invPaid || \"option3\"\n          },\n          {  \n            \"dispName\":\"... invoice is <b>voided</b>\",\n            \"req\":\"false\",\n            \"type\":\"DROPDOWN_DYNAMIC\",\n            \"id\":\"invVoided\",\n            \"isDynamic\":\"true\",\n            \"isSeperator\": true,\n            \"request\":{\n              \"type\":\"ON_CHANGE_FETCH_INPUT\",\n              \"apiEndPoint\":{\n                \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                \"type\":\"GET\",\n                \"headers\":{\n                  \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                  \"Elements-Formula-Instance-Id\": getPipelineStagesInstance\n                },\n                \"input\":{\n                  \"card\":\"invoice\"\n                }\n              }\n            },\n            \"dropDownItemsList\":[\n                  {\n                    \"disp\": \"Update existing deal\",\n                    \"value\": \"option2\",\n                    \"helptext\": \"Last Created Open deal will be updated in Pipedrive. <a href='' target='blank'>Learn More</a>\"\n                  },\n                  {\n                    \"disp\": \"Do Nothing\",\n                    \"value\": \"option3\"\n                  }\n              ],\n              \"defaultVal\": configJson.syncRulesDeals.invVoided || \"option3\"\n          },\n          {       \n          \"dispName\":\"Update deal value with invoice amount\",\n            \"desc\":\"Disable if you don't want Chargebee to deal value in Pipedrive with invoice amount.\",\n            \"req\":\"false\",\n            \"type\":\"TOGGLE\",\n            \"id\":\"updateDealValueWithInvoice\",\n            \"defaultVal\": ((configJson.syncRulesDeals.updateDealValueWithInvoice === \"true\") ? true : false) || \"option3\"\n          },\n          {       \n          \"dispName\":\"Allow Chargebee to add notes to deals\",\n            \"desc\":\"Enable if you want Chargebee to add notes to deals when changes are made to deal stage or deal value. <a href=\\\"\\\" target=\\\"blank\\\">Learn more</a>\",\n            \"req\":\"false\",\n            \"type\":\"TOGGLE\",\n            \"id\":\"addNotesInvoice\",\n            \"subCaption\":\"Example: \\\"Deal worth USD 99 created due to subscription (#12dfgh) creation in Chargebee\\\"\",\n            \"defaultVal\": ((configJson.syncRulesDeals.addNotesInvoice === \"true\") ? true : false) || false\n          }\n  ];\n  \n  // //IF ALL STEPS ARE DONOTHING\n  if((configJson.syncRulesDeals.invCreated === \"option3\") && (configJson.syncRulesDeals.invDeleted === \"option3\") && (configJson.syncRulesDeals.invPaid === \"option3\") && (configJson.syncRulesDeals.invVoided === \"option3\")){\n    for(var i=0; i < newParams_2.length; i++){\n      if(newParams_2[i]['id'] === \"updateDealValueWithInvoice\"){\n        newParams_2.splice(i);\n        if(newParams_2[i-1]['isSeperator'] !== undefined){\n          newParams_2[i-1]['isSeperator'] = undefined;\n        }\n      }\n    }\n  }\n  //  \n  \n  for(var j=0; j < newParams_2.length; j++){\n    if((newParams_2[j]['id'] === \"invCreated\") && (configJson.syncRulesDeals.invCreated !== \"option3\")){\n      pipeline = {  \n        \"dispName\":\"<p style='padding-left: 10px;'>- Choose the pipeline you'd like to add this deal to\",\n        \"req\":\"false\",\n        \"type\":\"DROPDOWN_DYNAMIC\",\n        \"id\":\"invCreatedPipeline\",\n        \"isDynamic\":\"true\",\n        \"request\":{\n          \"type\":\"ON_CHANGE_FETCH_INPUT\",\n          \"apiEndPoint\":{\n          \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n          \"type\":\"GET\",\n          \"headers\":{\n            \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n            \"Elements-Formula-Instance-Id\": getPipelineStagesInstance\n          },\n          \"input\":{\n              \"id\":\"chargebee\",\n              \"card\":\"invoice\",\n              \"selectedPipeline\" : \"invCreatedPipeline\"\n              }\n            }\n          },\n          \"dropDownItemsList\": pipelineList,\n          \"defaultVal\": configJson.syncRulesDeals.invCreatedPipeline || \"1\"\n      };\n      stage = {  \n          \"id\":\"invCreatedStage\",\n          \"dispName\":\"<p style='padding-left: 10px;'>- Choose the stage you'd like to add this deal to\",\n          \"req\":\"false\",\n          \"type\":\"DROPDOWN_DYNAMIC\",\n          \"request\":{\n            \"type\":\"ON_CHANGE_FETCH_INPUT\",\n            \"apiEndPoint\":{\n              \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n              \"type\":\"GET\",\n              \"headers\":{\n                \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                \"Elements-Formula-Instance-Id\": getPipelineStagesInstance\n              },\n              \"input\":{\n                \"id\":\"chargebee\"\n              }\n            }\n          },\n          \"dropDownItemsList\": stagesList[(configJson.syncRulesDeals.invCreatedPipeline-1)] || stagesList[0],\n          \"defaultVal\": configJson.syncRulesDeals.invCreatedStage\n        };\n      newParams_2.splice(j+1,0,pipeline);\n      newParams_2.splice(j+2,0,stage);\n    }\n    if((newParams_2[j]['id'] === \"invDeleted\") && (configJson.syncRulesDeals.invDeleted !== \"option3\")){\n      pipeline = {  \n        \"dispName\":\"<p style='padding-left: 10px;'>- Choose the pipeline you'd like to add this deal to\",\n        \"req\":\"false\",\n        \"type\":\"DROPDOWN_DYNAMIC\",\n        \"id\":\"invDeletedPipeline\",\n        \"isDynamic\":\"true\",\n        \"request\":{\n          \"type\":\"ON_CHANGE_FETCH_INPUT\",\n          \"apiEndPoint\":{\n          \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n          \"type\":\"GET\",\n          \"headers\":{\n            \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n            \"Elements-Formula-Instance-Id\": getPipelineStagesInstance\n          },\n          \"input\":{\n              \"id\":\"chargebee\",\n              \"card\":\"invoice\",\n              \"selectedPipeline\" : \"invDeletedPipeline\"\n              }\n            }\n          },\n          \"dropDownItemsList\": pipelineList,\n          \"defaultVal\": configJson.syncRulesDeals.invDeletedPipeline || \"1\"\n      };\n      stage = {  \n          \"id\":\"invDeletedStage\",\n          \"dispName\":\"<p style='padding-left: 10px;'>- Choose the stage you'd like to add this deal to\",\n          \"req\":\"false\",\n          \"type\":\"DROPDOWN_DYNAMIC\",\n          \"request\":{\n            \"type\":\"ON_CHANGE_FETCH_INPUT\",\n            \"apiEndPoint\":{\n              \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n              \"type\":\"GET\",\n              \"headers\":{\n                \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                \"Elements-Formula-Instance-Id\": getPipelineStagesInstance\n              },\n              \"input\":{\n                \"id\":\"chargebee\"\n              }\n            }\n          },\n          \"dropDownItemsList\": stagesList[(configJson.syncRulesDeals.invDeletedPipeline-1)] || stagesList[0],\n          \"defaultVal\": configJson.syncRulesDeals.invDeletedStage\n        };\n      newParams_2.splice(j+1,0,pipeline);\n      newParams_2.splice(j+2,0,stage);\n    }\n    if((newParams_2[j]['id'] === \"invPaid\") && (configJson.syncRulesDeals.invPaid !== \"option3\")){\n      pipeline = {  \n        \"dispName\":\"<p style='padding-left: 10px;'>- Choose the pipeline you'd like to add this deal to\",\n        \"req\":\"false\",\n        \"type\":\"DROPDOWN_DYNAMIC\",\n        \"id\":\"invPaidPipeline\",\n        \"isDynamic\":\"true\",\n        \"request\":{\n          \"type\":\"ON_CHANGE_FETCH_INPUT\",\n          \"apiEndPoint\":{\n          \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n          \"type\":\"GET\",\n          \"headers\":{\n            \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n            \"Elements-Formula-Instance-Id\": getPipelineStagesInstance\n          },\n          \"input\":{\n              \"id\":\"chargebee\",\n              \"card\":\"invoice\",\n              \"selectedPipeline\" : \"invPaidPipeline\"\n              }\n            }\n          },\n          \"dropDownItemsList\": pipelineList,\n          \"defaultVal\": configJson.syncRulesDeals.invPaidPipeline || \"1\"\n      };\n      stage = {  \n          \"id\":\"invPaidStage\",\n          \"dispName\":\"<p style='padding-left: 10px;'>- Choose the stage you'd like to add this deal to\",\n          \"req\":\"false\",\n          \"type\":\"DROPDOWN_DYNAMIC\",\n          \"request\":{\n            \"type\":\"ON_CHANGE_FETCH_INPUT\",\n            \"apiEndPoint\":{\n              \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n              \"type\":\"GET\",\n              \"headers\":{\n                \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                \"Elements-Formula-Instance-Id\": getPipelineStagesInstance\n              },\n              \"input\":{\n                \"id\":\"chargebee\"\n              }\n            }\n          },\n          \"dropDownItemsList\": stagesList[(configJson.syncRulesDeals.invPaidPipeline-1)] || stagesList[0],\n          \"defaultVal\": configJson.syncRulesDeals.invPaidStage\n        };\n      newParams_2.splice(j+1,0,pipeline);\n      newParams_2.splice(j+2,0,stage);\n    }\n    if((newParams_2[j]['id'] === \"invVoided\") && (configJson.syncRulesDeals.invVoided !== \"option3\")){\n      pipeline = {  \n        \"dispName\":\"<p style='padding-left: 10px;'>- Choose the pipeline you'd like to add this deal to\",\n        \"req\":\"false\",\n        \"type\":\"DROPDOWN_DYNAMIC\",\n        \"id\":\"invVoidedPipeline\",\n        \"isDynamic\":\"true\",\n        \"request\":{\n          \"type\":\"ON_CHANGE_FETCH_INPUT\",\n          \"apiEndPoint\":{\n          \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n          \"type\":\"GET\",\n          \"headers\":{\n            \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n            \"Elements-Formula-Instance-Id\": getPipelineStagesInstance\n          },\n          \"input\":{\n              \"id\":\"chargebee\",\n              \"card\":\"invoice\",\n              \"selectedPipeline\" : \"invVoidedPipeline\"\n              }\n            }\n          },\n          \"dropDownItemsList\": pipelineList,\n          \"defaultVal\": configJson.syncRulesDeals.invVoidedPipeline || \"1\"\n      };\n      stage = {  \n          \"id\":\"invVoidedStage\",\n          \"dispName\":\"<p style='padding-left: 10px;'>- Choose the stage you'd like to add this deal to\",\n          \"req\":\"false\",\n          \"isSeperator\": true,\n          \"type\":\"DROPDOWN_DYNAMIC\",\n          \"request\":{\n            \"type\":\"ON_CHANGE_FETCH_INPUT\",\n            \"apiEndPoint\":{\n              \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n              \"type\":\"GET\",\n              \"headers\":{\n                \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                \"Elements-Formula-Instance-Id\": getPipelineStagesInstance\n              },\n              \"input\":{\n                \"id\":\"chargebee\"\n              }\n            }\n          },\n          \"dropDownItemsList\": stagesList[(configJson.syncRulesDeals.invVoidedPipeline-1)] || stagesList[0],\n          \"defaultVal\": configJson.syncRulesDeals.invVoidedStage\n        };\n      newParams_2[j]['isSeperator'] = undefined;\n      newParams_2.splice(j+1,0,pipeline);\n      newParams_2.splice(j+2,0,stage);\n    }\n  }\n  card.cards[7].card.params = newParams_2;\n}\n\nif (customFields_customer.length > 0) {\n    for (var i = 0; i < customFields_customer.length; i++) {\n        temp = {\n            \"type\": \"CHECKBOX\",\n            \"id\": customFields_customer[i],\n            \"desc\": customFields.customer_custom_fields[customFields_customer[i]]\n        }\n        card.cards[9].card.params[2].inputFields[0].checkboxes.push(temp);\n    }\n}\n\nif (customFields_subscription.length > 0) {\n    for (var j = 0; j < customFields_subscription.length; j++) {\n        temp = {\n            \"type\": \"CHECKBOX\",\n            \"id\": customFields_subscription[j],\n            \"desc\": customFields.subscription_custom_fields[customFields_subscription[j]]\n        }\n        card.cards[9].card.params[2].inputFields[0].checkboxes.push(temp);\n    }\n}\n\ndone(card);"}},{"id":216432,"onSuccess":["getNewAccessToken"],"onFailure":[],"name":"triggerRefreshToken","type":"script","properties":{"body":"// let apiKey = \"test_FdeKa4XuFlZ6ZxikZjIrNLu1VNOkocOq\"\n// let siteName=\"ipaas-test\";\n// let siteDomain=\"chargebee-labs.com\";\n// let integration_name = \"pipedrive\";\n// let password = \"\";\n\nlet instanceId = steps.getTpConfig.response.body.third_party_configuration.config_json.cloudElements.formulas.formula_GetRefreshToken.instance || null\n//Instance id of getAccessTokenFormula formula\n\nlet triggerParams = {\n  url: \"/formulas/instances/\"+instanceId+\"/executions\",\n  body: {\n    apiKey: steps.InputParams.params.input.apiKey,\n    siteName: steps.InputParams.params.input.siteName,\n    siteDomain: steps.InputParams.params.input.siteDomain,\n    integration_name: steps.InputParams.params.input.integration_name,\n    password: steps.InputParams.params.input.password\n  }\n};\n\ndone({\n  triggerParams: triggerParams,\n  instanceId: instanceId\n});\n\n"}},{"id":216433,"onSuccess":["updateTpConfig_params"],"onFailure":[],"name":"updateConfiguration","type":"script","properties":{"body":"// let OAuth_Parameters = {\n//   \"OAuthDetails\": steps.getTpConfig.response.body.third_party_configuration.config_json.cloudElements.OAuth_Parameters\n// };\n\n// // OAuth_Parameters.OAuthDetails.access_token = steps.getNewToken.response.body.token_type + \" \" + steps.getNewToken.response.body.access_token;\n// // OAuth_Parameters.OAuthDetails.expiry_time = Math.round((new Date().getTime())/1000) + Number(steps.getNewToken.response.body.expires_in);\n// // OAuth_Parameters.OAuthDetails.refresh_token = steps.getNewToken.response.body.refresh_token;\n// // OAuth_Parameters.OAuthDetails.scope = steps.getNewToken.response.body.scope;\n// // OAuth_Parameters.OAuthDetails.token_type = steps.getNewToken.response.body.token_type;\n\n// done({\n//   OAuthData: OAuth_Parameters\n// });\n\n\n\ndone({\n  body :body\n});"}},{"id":216434,"onSuccess":["updateThirdPartyInstance"],"onFailure":[],"name":"updateElementInstanceParams","type":"script","properties":{"body":"let thirdPartyElementId = steps.getTpConfig.response.body.third_party_configuration.config_json.cloudElements.thirdParty.instance || null;\n\nlet configuration = steps.getThirdPartyInstanceDetails.response.body;\n\n let accessToken  = steps.OAuthDetails.OAuthData.OAuthDetails.access_token;\n\n configuration.configuration['access_token'] = accessToken;\n\nlet updateParams={\n  url: \"/instances/\"+thirdPartyElementId,\n  body: configuration\n};\n\ndone({\n  updateParams: updateParams\n});"}},{"id":216435,"onSuccess":["updateTpConfig_params"],"onFailure":[],"name":"updateThirdPartyInstance","type":"request","properties":{"body":"${steps.updateElementInstanceParams.updateParams.body}","api":"${steps.updateElementInstanceParams.updateParams.url}","method":"PUT"}},{"id":216436,"onSuccess":["SendProcessCardSuccess"],"onFailure":[],"name":"updateTpConfig","type":"httpRequest","properties":{"retryDelay":"200","body":"${steps.updateTpConfig_params.params.body}","url":"${steps.updateTpConfig_params.params.url}","headers":"${steps.updateTpConfig_params.params.headers}","retry":"true","retryAttempts":"5","method":"POST"}},{"id":225916,"onSuccess":["sendProcessCard_instanceCreation"],"onFailure":[],"name":"updateTpConfig_2","type":"httpRequest","properties":{"body":"${steps.updateTpConfigParams_2.tpConfigUpdateParams.body}","url":"${steps.updateTpConfigParams_2.tpConfigUpdateParams.url}","headers":"${steps.updateTpConfigParams_2.tpConfigUpdateParams.headers}","method":"POST"}},{"id":216437,"onSuccess":["updateTpConfig"],"onFailure":[],"name":"updateTpConfig_params","type":"script","properties":{"body":"let OAuthData = steps.OAuthDetails.OAuthData;\nlet configuration = steps.getTpConfig.response.body.third_party_configuration.config_json;\n\nif(OAuthData !== null){\n configuration.cloudElements.OAuth_Parameters = OAuthData.OAuthDetails;\n}\n\nlet body = {\n     site_name: steps.InputParams.params.input.siteName,\n     api_key: steps.InputParams.params.input.apiKey,\n     integration_name: steps.InputParams.params.input.integrationName,\n     config_json: configuration\n  };\n\n\nlet updateTpConfigParams = {\n  url: \"https://\"+steps.InputParams.params.input.siteName+\".integrations.\"+steps.InputParams.params.input.siteDomain+\"/integrations/update_tp_integ_conf\",\n  headers: {\n    \"Content-Type\": \"application/json\",\n    \"cache-control\": \"no-cache\"\n  },\n  body: body\n};\n\ndone({\n  params: updateTpConfigParams\n});\n\n\n"}},{"id":225914,"onSuccess":["updateTpConfig_2"],"onFailure":[],"name":"updateTpConfigParams_2","type":"script","properties":{"body":"let configJson = steps.getTpConfig.response.body.third_party_configuration.config_json;\n\nif(steps.isInstanceExist.continue === true){\n  configJson.cloudElements.formulas.formula_ManageSyncRules_Save.instance = steps.checkInstanceExist.instanceInfo.id;\n}else{\n  configJson.cloudElements.formulas.formula_ManageSyncRules_Save.instance = steps.newInstanceCreatedInfo.id;\n}\n\nlet tpConfigUpdateParams = steps.InputParams.updateTpConfigParams;\ntpConfigUpdateParams.body.config_json = configJson;\n\ndone({\n  tpConfigUpdateParams: tpConfigUpdateParams\n});"}}],"triggers":[{"id":26053,"onSuccess":["EnvProps"],"onFailure":[],"type":"manual","async":true,"name":"trigger","properties":{}}],"method":"GET","uri":"/pipedrive/manageSyncRules","engine":"v1","active":true,"debugLoggingEnabled":true,"singleThreaded":false,"api":"GET /pipedrive/manageSyncRules","configuration":[]}