{"id":29421,"name":"testing-pipedriveGetPipelineStages","userId":27893,"accountId":24428,"createdDate":"2019-09-05T07:09:43Z","steps":[{"id":216373,"onSuccess":["loopOverPipelines"],"onFailure":["Error"],"name":"addStagesToList","type":"script","properties":{"body":"let stagesData;\nlet temp;\nlet outputData = [];\n\n// if((steps.getStagesFromPipedrive.response.code !== 200) || (steps.getStagesFromPipedrive.response.body.data === undefined) || (steps.getStagesFromPipedrive.response.body.data.length === 0)){\n//   done(false);\n// }\n\nif((steps.getStagesFromPipedrive.response.code !== 200) || (steps.getStagesFromPipedrive.response.body.data === undefined) || (steps.getStagesFromPipedrive.response.body.data.length === 0)){\n  \n  if((steps.getStagesFromPipedrive_params.stageList !== undefined) && (steps.getStagesFromPipedrive_params.stageList.length !== 0)){\n      stagesData = steps.getStagesFromPipedrive_params.stageList;\n      done({\n        stages: stagesData\n      });\n  }\n  done(false);\n}\n\nstagesData = steps.getStagesFromPipedrive.response.body.data;\n\nfor(var i=0; i < stagesData.length; i++){\n  if(stagesData[i].active_flag === false){\n    continue;\n  }\n  \n// temp = {\n//     \"value\": stagesData[i].id,\n//     \"disp\": stagesData[i].name,\n//     \"helptext\": \"Last Created Open deal will be updated in Pipedrive. <a href='' target='blank'>Learn More</a>\" \n//   };\n  temp = {\n    \"value\": stagesData[i].id,\n    \"disp\": stagesData[i].name\n   };\n   outputData.push(temp);\n}\n\nif(steps.getStagesFromPipedrive_params.stageList.length !== 0){\n  let stageData = steps.getStagesFromPipedrive_params.stageList;\n  stageData.push(outputData);\n  done({\n    stages: stageData\n  });\n}\n\n\n// done({\n//   stages: outputData\n// });\n\ndone({\n  stages: [outputData]\n});"}},{"id":223118,"onSuccess":[],"onFailure":[],"name":"AuthError","type":"script","properties":{"body":"let card = {\n \"status\": \"error\",\n \"notice\" : \"Pipedrive Authentication Error. Please refresh the page and try again.\"\n};\n\ndone({\n  statusCode: 200,\n  result: card\n});"}},{"id":222923,"onSuccess":["InputParams"],"onFailure":[],"name":"EnvProps","type":"script","properties":{"body":"let cloudElementsUrl = \"https://staging.cloud-elements.com/elements/api-v2\";\n\nconsole.log(info);\n\ndone({\n  cloudElementsUrl: cloudElementsUrl\n});"}},{"id":223112,"onSuccess":[],"onFailure":[],"name":"Error","type":"script","properties":{"body":"let card = {\n  \"status\": \"error\",\n  \"notice\" : \"Failed to Fetch Data. Please refresh the page and try again.\"\n};\n\ndone({\n  statusCode: 200,\n  result: card\n});\n\n\n// let cloudElementsUrl = steps.EnvProps.cloudElementsUrl;\n\n// let card = {\n//     \"cards\": [{\n//         \"id\": \"testdynamic2\",\n//         \"isCardDone\" : false,\n//         \"card\": {\n//             \"type\": \"ACTION\",\n//             \"heading\": \"Error\",\n//             \"listContent\": [\n//                 \"Pipedrive is unavailable. Please try again later.\"\n//             ],\n//             \"icon\": \"ERROR\"\n//         }\n//     },\n//     {\n//       \"id\": \"testdynamic\",\n//       \"isCardDone\": false,\n//       \"card\":{\n//             \"type\": \"ACTION\",\n//             \"heading\": \"\",\n//             \"listContent\": []\n//         }\n//     }],\n//     \"retry\": {\n//       \"buttonLook\": \"FILLED\",\n//       \"display\": \"Resolve\",\n//       \"icon\": \"ARROW\",\n//       \"id\": \"retry\",\n//       \"request\": {\n//         \"apiEndPoint\": {\n//           \"apiUrl\": cloudElementsUrl+\"/pipedrive/syncRulesDealsSetup\",\n//           \"headers\": {\n//             \"Elements-Formula-Instance-Id\": steps.getTpConfig.response.body.third_party_configuration.config_json.cloudElements.formulas.formula_SyncRulesDealsSetup.instance\n//           },\n//           \"input\": {\n//             \"siteDomain\": steps.InputParams.params.input.siteDomain,\n//             \"integrationName\": steps.InputParams.params.input.integrationName\n//           },\n//           \"type\": \"GET\"\n//         },\n//         \"type\": \"ON_CLICK_DEFAULT_ACTION\"\n//       },\n//       \"type\": \"DIRECT_LINK\"\n//     }\n// }\n\n\n// done({\n//   statusCode: 200,\n//   result: card\n// });"}},{"id":223117,"onSuccess":[],"onFailure":[],"name":"getNewAccessToken","type":"request","properties":{"body":"${steps.triggerRefreshToken.triggerParams.body}","api":"${steps.triggerRefreshToken.triggerParams.url}","method":"POST"}},{"id":216374,"onSuccess":["listPipelines"],"onFailure":["isTokenExpired"],"name":"getPipelinesFromPipedrive","type":"httpRequest","properties":{"url":"${steps.getPipelinesFromPipedrive_params.payload.url}","headers":"${steps.getPipelinesFromPipedrive_params.payload.header}","method":"GET"}},{"id":216375,"onSuccess":["getPipelinesFromPipedrive"],"onFailure":[],"name":"getPipelinesFromPipedrive_params","type":"script","properties":{"body":"let payload = {\n  url : \"https://api-proxy.pipedrive.com/pipelines\",\n  header: {\n    \"Authorization\": steps.getTpConfig.response.body.third_party_configuration.config_json.cloudElements.OAuth_Parameters.access_token || null\n  }\n}\n\n\ndone({\n  payload: payload\n});"}},{"id":216376,"onSuccess":["addStagesToList"],"onFailure":["isTokenExpired"],"name":"getStagesFromPipedrive","type":"httpRequest","properties":{"query":"${steps.getStagesFromPipedrive_params.payload.query}","url":"${steps.getStagesFromPipedrive_params.payload.url}","headers":"${steps.getStagesFromPipedrive_params.payload.header}","retry":"false","method":"GET"}},{"id":216377,"onSuccess":["getStagesFromPipedrive"],"onFailure":["Error"],"name":"getStagesFromPipedrive_params","type":"script","properties":{"body":"// let pipelineId = Number(trigger.args.request.query['subCreatedPipeline']) || 1;\n// if(steps.InputParams.params.input.selectedPipeline !== null){\n//   pipelineId = steps.InputParams.params.input.selectedPipeline;\n// }\n\n\nlet pipelineId = steps.loopOverPipelines.entry.value;\nlet stageList = [];\n\nlet payload = {\n  url : \"https://api-proxy.pipedrive.com/stages\",\n  header: {\n    \"Authorization\": steps.getTpConfig.response.body.third_party_configuration.config_json.cloudElements.OAuth_Parameters.access_token || null\n  },\n  query: {\n    \"pipeline_id\" : pipelineId\n  }\n}\n\nif(steps.addStagesToList !== undefined){\n  stageList = steps.addStagesToList.stages;\n}\n\nconsole.log(stageList.length);\n\ndone({\n  payload: payload,\n  stageList: stageList\n});"}},{"id":216378,"onSuccess":["getPipelinesFromPipedrive_params"],"onFailure":["Error"],"name":"getTpConfig","type":"httpRequest","properties":{"query":"${steps.InputParams.getTpConfigParams.query}","url":"${steps.InputParams.getTpConfigParams.url}","headers":"${steps.InputParams.getTpConfigParams.auth}","method":"GET"}},{"id":216379,"onSuccess":["getTpConfig"],"onFailure":[],"name":"InputParams","type":"script","properties":{"body":"let apiKey = trigger.args.request.query['cb-api-key'];\nlet siteName = trigger.args.request.query['cb-site-name'];\nlet siteDomain = trigger.args.request.query['cb-domain'];\nlet integration_name = \"pipedrive\";\nlet password = \"\";\n\nlet changeSubscriptionCard = false;\nlet changeInvoiceCard = false;\n\n// if((trigger.args.request.query['subCreated'] !== undefined) || (trigger.args.request.query['subUpdated'] !== undefined) || (trigger.args.request.query['subDeleted'] !== undefined) || (trigger.args.request.query['subPaused'] !== undefined) || (trigger.args.request.query['subResumed'] !== undefined) || (trigger.args.request.query[''] !== undefined) || (trigger.args.request.query['subCancelled'] !== undefined) || (trigger.args.request.query['subReactivated'] !== undefined)){\n//   changeSubscriptionCard = true;\n// }\n\n// if((trigger.args.request.query['invCreatedPipeline'] !== undefined) || (trigger.args.request.query['invDeletedPipeline'] !== undefined) || (trigger.args.request.query['invPaidPipeline'] !== undefined) || (trigger.args.request.query['invVoidedPipeline'] !== undefined)){\n//   changeInvoiceCard = true;\n// }\n\nif(trigger.args.request.query['card'] === \"subscription\"){\n  changeSubscriptionCard = true;\n}\n\nif(trigger.args.request.query['card'] === \"invoice\"){\n  changeInvoiceCard = true;\n}\n\nlet selectedPipeline = null;\nif(trigger.args.request.query['selectedPipeline'] !== undefined){\n  let pipeline = trigger.args.request.query['selectedPipeline'];\n  selectedPipeline = trigger.args.request.query[pipeline];\n}\n\n\nlet params = {\n  input:{\n    apiKey: apiKey,\n    siteName: siteName,\n    siteDomain: siteDomain,\n    integration_name: integration_name,\n    password: password,\n    changeSubscriptionCard: changeSubscriptionCard,\n    changeInvoiceCard : changeInvoiceCard,\n    selectedPipeline : selectedPipeline\n  }\n};\n\n\nlet getTpConfigParams = {\n  url: \"https://\"+siteName+\".\"+siteDomain+\"/api/v2/third_party_configurations\",\n  auth:{\n    Authorization: \"Basic \" + CE.b64(apiKey + \":\" + password)\n  },\n  query:{\n    integration_name: integration_name\n  }\n}\n\ndone({\n  params: params,\n  getTpConfigParams: getTpConfigParams\n});"}},{"id":223111,"onSuccess":["AuthError"],"onFailure":["Error"],"name":"isTokenExpired","type":"filter","properties":{"body":"if(steps.getPipelinesFromPipedrive !== undefined){\n  if(steps.getPipelinesFromPipedrive.response.code === 401){\n    done(true);\n  }\n}\n\nif(steps.getStagesFromPipedrive !== undefined){\n if(steps.getStagesFromPipedrive.response.code === 401){\n   done(true);\n }\n}\n\ndone(false);"}},{"id":216380,"onSuccess":["loopOverPipelines"],"onFailure":["Error"],"name":"listPipelines","type":"script","properties":{"body":"if((steps.getPipelinesFromPipedrive.response.code !== 200) || (steps.getPipelinesFromPipedrive.response.body.data === undefined) || (steps.getPipelinesFromPipedrive.response.body.data.length === 0)){\n  done(false);\n}\n\n\nlet pipelineData = steps.getPipelinesFromPipedrive.response.body.data;\nlet temp;\nlet outputData = [];\n\nfor(var i=0; i < pipelineData.length; i++){\n  if(pipelineData[i].active === false){\n    continue;\n  }\n  \n  // temp = {\n  //   \"id\" : pipelineData[i].id,\n  //   \"name\" : pipelineData[i].name\n  // }\n  \n  temp = {\n    \"value\": pipelineData[i].id,\n    \"disp\": pipelineData[i].name\n   };\n   outputData.push(temp);\n  // pipelineDropdownContent.push(temp);\n  \n}\n\n// temp = {\n//   \"value\":\"doNothing\",                       \n//   \"disp\":\"Do Nothing\"       \n// };\n\n// outputData.push(temp);\n\n\ndone({\n  pipeline: outputData\n});\n"}},{"id":216381,"onSuccess":["Success"],"onFailure":["Error"],"name":"listStages","type":"script","properties":{"body":"let stageList = [];\n\nif(steps.addStagesToList !== undefined){\n  stageList = steps.addStagesToList.stages;\n}\n\ndone({\n  stageList : stageList\n});"}},{"id":216382,"onSuccess":["getStagesFromPipedrive_params"],"onFailure":["listStages"],"name":"loopOverPipelines","type":"loop","properties":{"list":"${steps.listPipelines.pipeline.entry}"}},{"id":216383,"onSuccess":[],"onFailure":["Error"],"name":"Success","type":"script","properties":{"body":"let cloudElementsUrl = steps.EnvProps.cloudElementsUrl;\nlet instanceId = info.formulaInstanceId;\n\nlet pipelineList = steps.listPipelines.pipeline;\nlet stagesList = steps.listStages.stageList;\n\nlet pipeline;\nlet stage;\nlet subscriptionCard_body;\n\nlet card = {\n  \"cards\" : []\n};\n\nif(steps.InputParams.params.input.changeInvoiceCard === true){\n\n    let invoiceCard_body = {\n        \"card\": {\n            \"heading\": \"Choose how you'd like to handle deals in Pipedrive when\",\n            \"type\" : \"DYNAMIC_INPUT\",\n            \"params\": [\n              {  \n                \"dispName\":\"... invoice is <b>created</b>\",\n                \"req\":\"false\",\n                \"type\":\"DROPDOWN_DYNAMIC\",\n                \"id\":\"invCreated\",\n                \"isDynamic\":\"true\",\n                \"request\":{\n                  \"type\":\"ON_CHANGE_FETCH_INPUT\",\n                  \"apiEndPoint\":{\n                    \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                    \"type\":\"GET\",\n                    \"headers\":{\n                      \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                      \"Elements-Formula-Instance-Id\": instanceId\n                    },\n                    \"input\":{\n                      \"card\":\"invoice\"\n                    }\n                  }\n                },\n                \"dropDownItemsList\":[\n                  {\n                    \"disp\": \"Create a deal\",\n                    \"value\": \"option1\"\n                  },\n                  {\n                    \"disp\": \"Update existing deal\",\n                    \"value\": \"option2\",\n                    \"helptext\": \"Last Created Open deal will be updated in Pipedrive. <a href='' target='blank'>Learn More</a>\"\n                  },\n                  {\n                    \"disp\": \"Do Nothing\",\n                    \"value\": \"option3\"\n                  }\n                ],\n                \"defaultVal\": trigger.args.request.query['invCreated'] || \"option3\"\n              },\n              {  \n                \"dispName\":\"... invoice is <b>deleted</b>\",\n                \"req\":\"false\",\n                \"type\":\"DROPDOWN_DYNAMIC\",\n                \"id\":\"invDeleted\",\n                \"isDynamic\":\"true\",\n                \"request\":{\n                  \"type\":\"ON_CHANGE_FETCH_INPUT\",\n                  \"apiEndPoint\":{\n                    \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                    \"type\":\"GET\",\n                    \"headers\":{\n                      \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                      \"Elements-Formula-Instance-Id\": instanceId\n                    },\n                    \"input\":{\n                      \"card\":\"invoice\"\n                    }\n                  }\n                },\n                \"dropDownItemsList\":[\n                  {\n                    \"disp\": \"Update existing deal\",\n                    \"value\": \"option2\",\n                    \"helptext\": \"Last Created Open deal will be updated in Pipedrive. <a href='' target='blank'>Learn More</a>\"\n                  },\n                  {\n                    \"disp\": \"Do Nothing\",\n                    \"value\": \"option3\"\n                  }\n                ],\n                  \"defaultVal\": trigger.args.request.query['invDeleted'] || \"option3\"\n              },\n              {  \n                \"dispName\":\"... invoice is <b>paid</b>\",\n                \"req\":\"false\",\n                \"type\":\"DROPDOWN_DYNAMIC\",\n                \"id\":\"invPaid\",\n                \"isDynamic\":\"true\",\n                \"request\":{\n                  \"type\":\"ON_CHANGE_FETCH_INPUT\",\n                  \"apiEndPoint\":{\n                    \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                    \"type\":\"GET\",\n                    \"headers\":{\n                      \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                      \"Elements-Formula-Instance-Id\": instanceId\n                    },\n                    \"input\":{\n                      \"card\":\"invoice\"\n                    }\n                  }\n                },\n                \"dropDownItemsList\":[\n                  {\n                    \"disp\": \"Update existing deal\",\n                    \"value\": \"option2\",\n                    \"helptext\": \"Last Created Open deal will be updated in Pipedrive. <a href='' target='blank'>Learn More</a>\"\n                  },\n                  {\n                    \"disp\": \"Do Nothing\",\n                    \"value\": \"option3\"\n                  }\n                ],\n                  \"defaultVal\": trigger.args.request.query['invPaid'] || \"option3\"\n              },\n              \n               {  \n                \"dispName\":\"... invoice is <b>voided</b>\",\n                \"req\":\"false\",\n                \"type\":\"DROPDOWN_DYNAMIC\",\n                \"id\":\"invVoided\",\n                \"isSeperator\":true,\n                \"isDynamic\":\"true\",\n                \"request\":{\n                  \"type\":\"ON_CHANGE_FETCH_INPUT\",\n                  \"apiEndPoint\":{\n                    \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                    \"type\":\"GET\",\n                    \"headers\":{\n                      \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                      \"Elements-Formula-Instance-Id\": instanceId\n                    },\n                    \"input\":{\n                      \"card\":\"invoice\"\n                    }\n                  }\n                },\n                \"dropDownItemsList\":[\n                  {\n                    \"disp\": \"Update existing deal\",\n                    \"value\": \"option2\",\n                    \"helptext\": \"Last Created Open deal will be updated in Pipedrive. <a href='' target='blank'>Learn More</a>\"\n                  },\n                  {\n                    \"disp\": \"Do Nothing\",\n                    \"value\": \"option3\"\n                  }\n                ],\n                  \"defaultVal\": trigger.args.request.query['invVoided'] || \"option3\"\n              },\n              {       \n              \"dispName\":\"Update deal value with invoice amount\",\n                \"desc\":\"Disable if you don't want Chargebee to deal value in Pipedrive with invoice amount.\",\n                \"req\":\"false\",\n                \"type\":\"TOGGLE\",\n                \"id\":\"updateDealValueWithInvoice\",\n                \"defaultVal\": trigger.args.request.query['updateDealValueWithInvoice'] || false\n              },\n              {       \n              \"dispName\":\"Allow Chargebee to add notes to deals\",\n                \"desc\":\"Enable if you want Chargebee to add notes to deals when changes are made to deal stage or deal value. <a href=\\\"https://www.chargebee.com\\\" target=\\\"blank\\\">Learn More</a>\",\n                \"req\":\"false\",\n                \"type\":\"TOGGLE\",\n                \"id\":\"addNotesInvoice\",\n                \"defaultVal\": trigger.args.request.query['addNotesInvoice'] || false,\n                \"subCaption\":\"Example: \\\"Deal worth USD 99 created due to subscription (#12dfgh) creation in Chargebee\\\"\"\n              }\n            ]\n        },\n        \"id\" : \"testdynamic2\",\n        \"isCardDone\": \"true\"\n    };\n    \n    if((trigger.args.request.query['invCreated'] !== undefined) && (trigger.args.request.query['invCreated'] !== \"option3\")){\n        pipeline = {  \n            \"dispName\":\"<p style='padding-left: 10px;'>- Choose the pipeline you'd like to add this deal to\",\n            \"req\":\"false\",\n            \"type\":\"DROPDOWN_DYNAMIC\",\n            \"id\":\"invCreatedPipeline\",\n            \"isDynamic\":\"true\",\n            \"request\":{\n              \"type\":\"ON_CHANGE_FETCH_INPUT\",\n              \"apiEndPoint\":{\n              \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n              \"type\":\"GET\",\n              \"headers\":{\n                \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                \"Elements-Formula-Instance-Id\": instanceId\n              },\n              \"input\":{\n                  \"id\":\"chargebee\",\n                  \"card\":\"invoice\",\n                  \"selectedPipeline\" : \"invCreatedPipeline\"\n                  }\n                  }\n              },\n              \"dropDownItemsList\": pipelineList,\n              \"defaultVal\": trigger.args.request.query['invCreatedPipeline'] || \"1\"\n        };\n        stage = {  \n            \"id\":\"invCreatedStage\",\n            \"dispName\":\"<p style='padding-left: 10px;'>- Choose the stage you'd like to add this deal to\",\n            \"req\":\"false\",\n            \"type\":\"DROPDOWN_DYNAMIC\",\n            \"request\":{\n              \"type\":\"ON_CHANGE_FETCH_INPUT\",\n              \"apiEndPoint\":{\n                \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                \"type\":\"GET\",\n                \"headers\":{\n                  \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                  \"Elements-Formula-Instance-Id\": instanceId\n                },\n                \"input\":{\n                  \"id\":\"chargebee\"\n                }\n              }\n            },\n            \"dropDownItemsList\": stagesList[(trigger.args.request.query['invCreatedPipeline']-1)] || stagesList[0],\n            \"defaultVal\": (trigger.args.request.query['invCreatedStage'] !== undefined) ? trigger.args.request.query['invCreatedStage'] : stagesList[(pipeline.defaultVal)-1][0]['value']\n          };\n        for(var i=0; i < invoiceCard_body.card.params.length; i++){\n            if(invoiceCard_body.card.params[i]['id'] === \"invCreated\"){\n                invoiceCard_body.card.params.splice(i+1,0,pipeline);\n                invoiceCard_body.card.params.splice(i+2,0,stage);\n                break;\n            }\n        }\n    }\n\n    if((trigger.args.request.query['invDeleted'] !== undefined) && (trigger.args.request.query['invDeleted'] !== \"option3\")){\n        pipeline = {  \n            \"dispName\":\"<p style='padding-left: 10px;'>- Choose the pipeline you'd like to add this deal to\",\n            \"req\":\"false\",\n            \"type\":\"DROPDOWN_DYNAMIC\",\n            \"id\":\"invDeletedPipeline\",\n            \"isDynamic\":\"true\",\n            \"request\":{\n              \"type\":\"ON_CHANGE_FETCH_INPUT\",\n              \"apiEndPoint\":{\n              \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n              \"type\":\"GET\",\n              \"headers\":{\n                \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                \"Elements-Formula-Instance-Id\": instanceId\n              },\n              \"input\":{\n                  \"id\":\"chargebee\",\n                  \"card\": \"invoice\",\n                  \"selectedPipeline\" : \"invDeletedPipeline\"\n                  }\n                  }\n              },\n              \"dropDownItemsList\": pipelineList,\n              \"defaultVal\": trigger.args.request.query['invDeletedPipeline'] || \"1\"\n        };\n        stage = {  \n            \"id\":\"invDeletedStage\",\n            \"dispName\":\"<p style='padding-left: 10px;'>- Choose the stage you'd like to add this deal to\",\n            \"req\":\"false\",\n            \"type\":\"DROPDOWN_DYNAMIC\",\n            \"request\":{\n              \"type\":\"ON_CHANGE_FETCH_INPUT\",\n              \"apiEndPoint\":{\n                \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                \"type\":\"GET\",\n                \"headers\":{\n                  \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                  \"Elements-Formula-Instance-Id\": instanceId\n                },\n                \"input\":{\n                  \"id\":\"chargebee\"\n                }\n              }\n            },\n            \"dropDownItemsList\": stagesList[(trigger.args.request.query['invDeletedPipeline']-1)] || stagesList[0],\n            \"defaultVal\": (trigger.args.request.query['invDeletedStage'] !== undefined) ? trigger.args.request.query['invDeletedStage'] : stagesList[(pipeline.defaultVal)-1][0]['value']\n        };\n        for(var i=0; i < invoiceCard_body.card.params.length; i++){\n            if(invoiceCard_body.card.params[i]['id'] === \"invDeleted\"){\n                invoiceCard_body.card.params.splice(i+1,0,pipeline);\n                invoiceCard_body.card.params.splice(i+2,0,stage);\n                break;\n            }\n        }\n    }\n\n    if((trigger.args.request.query['invPaid'] !== undefined) && (trigger.args.request.query['invPaid'] !== \"option3\")){\n        pipeline = {  \n            \"dispName\":\"<p style='padding-left: 10px;'>- Choose the pipeline you'd like to add this deal to\",\n            \"req\":\"false\",\n            \"type\":\"DROPDOWN_DYNAMIC\",\n            \"id\":\"invPaidPipeline\",\n            \"isDynamic\":\"true\",\n            \"request\":{\n              \"type\":\"ON_CHANGE_FETCH_INPUT\",\n              \"apiEndPoint\":{\n              \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n              \"type\":\"GET\",\n              \"headers\":{\n                \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                \"Elements-Formula-Instance-Id\": instanceId\n              },\n              \"input\":{\n                  \"id\":\"chargebee\",\n                  \"card\": \"invoice\",\n                  \"selectedPipeline\" : \"invPaidPipeline\"\n                  }\n                  }\n              },\n              \"dropDownItemsList\": pipelineList,\n              \"defaultVal\": trigger.args.request.query['invPaidPipeline'] || \"1\"\n          };\n        stage = {  \n            \"id\":\"invPaidStage\",\n            \"dispName\":\"<p style='padding-left: 10px;'>- Choose the stage you'd like to add this deal to\",\n            \"req\":\"false\",\n            \"type\":\"DROPDOWN_DYNAMIC\",\n            \"request\":{\n              \"type\":\"ON_CHANGE_FETCH_INPUT\",\n              \"apiEndPoint\":{\n                \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                \"type\":\"GET\",\n                \"headers\":{\n                  \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                  \"Elements-Formula-Instance-Id\": instanceId\n                },\n                \"input\":{\n                  \"id\":\"chargebee\"\n                }\n              }\n            },\n            \"dropDownItemsList\": stagesList[(trigger.args.request.query['invPaidPipeline']-1)] || stagesList[0],\n            \"defaultVal\": (trigger.args.request.query['invPaidStage'] !== undefined) ? trigger.args.request.query['invPaidStage'] : stagesList[(pipeline.defaultVal)-1][0]['value']\n        };\n        for(var i=0; i < invoiceCard_body.card.params.length; i++){\n            if(invoiceCard_body.card.params[i]['id'] === \"invPaid\"){\n                invoiceCard_body.card.params.splice(i+1,0,pipeline);\n                invoiceCard_body.card.params.splice(i+2,0,stage);\n                break;\n            }\n        }\n    }\n\n    if((trigger.args.request.query['invVoided'] !== undefined) && (trigger.args.request.query['invVoided'] !== \"option3\")){\n        pipeline = {  \n            \"dispName\":\"<p style='padding-left: 10px;'>- Choose the pipeline you'd like to add this deal to\",\n            \"req\":\"false\",\n            \"type\":\"DROPDOWN_DYNAMIC\",\n            \"id\":\"invVoidedPipeline\",\n            \"isDynamic\":\"true\",\n            \"request\":{\n              \"type\":\"ON_CHANGE_FETCH_INPUT\",\n              \"apiEndPoint\":{\n              \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n              \"type\":\"GET\",\n              \"headers\":{\n                \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                \"Elements-Formula-Instance-Id\": instanceId\n              },\n              \"input\":{\n                  \"id\":\"chargebee\",\n                  \"card\": \"invoice\",\n                  \"selectedPipeline\" : \"invVoidedPipeline\"\n                  }\n                  }\n              },\n              \"dropDownItemsList\": pipelineList,\n              \"defaultVal\": trigger.args.request.query['invVoidedPipeline'] || \"1\"\n        };\n        stage = {  \n            \"id\":\"invVoidedStage\",\n            \"dispName\":\"<p style='padding-left: 10px;'>- Choose the stage you'd like to add this deal to\",\n            \"req\":\"false\",\n            \"isSeperator\":true,\n            \"type\":\"DROPDOWN_DYNAMIC\",\n            \"request\":{\n              \"type\":\"ON_CHANGE_FETCH_INPUT\",\n              \"apiEndPoint\":{\n                \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                \"type\":\"GET\",\n                \"headers\":{\n                  \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                  \"Elements-Formula-Instance-Id\": instanceId\n                },\n                \"input\":{\n                  \"id\":\"chargebee\"\n                }\n              }\n            },\n            \"dropDownItemsList\": stagesList[(trigger.args.request.query['invVoidedPipeline']-1)] || stagesList[0],\n            \"defaultVal\": (trigger.args.request.query['invVoidedStage'] !== undefined) ? trigger.args.request.query['invVoidedStage'] : stagesList[(pipeline.defaultVal)-1][0]['value']\n        };\n        for(var i=0; i < invoiceCard_body.card.params.length; i++){\n            if(invoiceCard_body.card.params[i]['id'] === \"invVoided\"){\n                invoiceCard_body.card.params[i]['isSeperator'] = undefined;\n                invoiceCard_body.card.params.splice(i+1,0,pipeline);\n                invoiceCard_body.card.params.splice(i+2,0,stage);\n                break;\n            }\n        }\n    }\n  \n  //IF ALL STEPS ARE DONOTHING\n  if((trigger.args.request.query['invCreated'] === \"option3\") && (trigger.args.request.query['invDeleted'] === \"option3\") && (trigger.args.request.query['invPaid'] === \"option3\") && (trigger.args.request.query['invVoided'] === \"option3\")){\n    for(var i=0; i < invoiceCard_body.card.params.length; i++){\n      if(invoiceCard_body.card.params[i]['id'] === \"updateDealValueWithInvoice\"){\n          invoiceCard_body.card.params.splice(i);\n          if(invoiceCard_body.card.params[i-1]['isSeperator'] !== undefined){\n            invoiceCard_body.card.params[i-1]['isSeperator'] = undefined;\n          }\n      }\n    }\n  }\n  //  \n    \n  card.cards.push(invoiceCard_body);\n  \n}\n\nif(steps.InputParams.params.input.changeSubscriptionCard === true){\n    subscriptionCard_body = {\n        \"card\": {\n            \"heading\":\"Choose how you'd like to handle deals in Pipedrive when\",\n            \"type\" : \"DYNAMIC_INPUT\",\n            \"params\": [\n              {  \n                \"dispName\":\"... subscription is <b>created</b>\",\n                \"req\":\"false\",\n                \"type\":\"DROPDOWN_DYNAMIC\",\n                \"id\":\"subCreated\",\n                \"isDynamic\":\"true\",\n                \"request\":{\n                    \"type\":\"ON_CHANGE_FETCH_INPUT\",\n                    \"apiEndPoint\":{\n                      \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                      \"type\":\"GET\",\n                      \"headers\":{\n                        \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                        \"Elements-Formula-Instance-Id\": instanceId\n                      },\n                      \"input\":{\n                        \"card\":\"subscription\"\n                      }\n                    }\n                  },\n                  \"dropDownItemsList\":[\n                    {\n                      \"disp\": \"Create a deal\",\n                      \"value\": \"option1\"\n                    },\n                    {\n                      \"disp\": \"Update existing deal\",\n                      \"value\": \"option2\",\n                      \"helptext\": \"Last Created Open deal will be updated in Pipedrive. <a href='' target='blank'>Learn More</a>\"\n                    },\n                    {\n                      \"disp\": \"Do Nothing\",\n                      \"value\": \"option3\"\n                    }\n                  ],\n                  \"defaultVal\": trigger.args.request.query['subCreated'] || \"option1\"\n              },\n              {  \n                \"dispName\":\"... subscription items are <b>updated</b>\",\n                \"req\":\"false\",\n                \"type\":\"DROPDOWN_DYNAMIC\",\n                \"id\":\"subUpdated\",\n                \"isDynamic\":\"true\",\n                \"request\":{\n                  \"type\":\"ON_CHANGE_FETCH_INPUT\",\n                  \"apiEndPoint\":{\n                    \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                    \"type\":\"GET\",\n                    \"headers\":{\n                      \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                      \"Elements-Formula-Instance-Id\": instanceId\n                    },\n                    \"input\":{\n                        \"card\":\"subscription\"\n                    }\n                  }\n                },\n                \"dropDownItemsList\":[\n                  {\n                    \"disp\": \"Update existing deal\",\n                    \"value\": \"option2\",\n                    \"helptext\": \"Last Created Open deal will be updated in Pipedrive. <a href='' target='blank'>Learn More</a>\"\n                  },\n                  {\n                    \"disp\": \"Do Nothing\",\n                    \"value\": \"option3\"\n                  }\n                ],\n                  \"defaultVal\": trigger.args.request.query['subUpdated'] || \"option3\"\n              },\n              {  \n                \"dispName\":\"... subscription is <b>deleted</b>\",\n                \"req\":\"false\",\n                \"type\":\"DROPDOWN_DYNAMIC\",\n                \"id\":\"subDeleted\",\n                \"isDynamic\":\"true\",\n                \"request\":{\n                    \"type\":\"ON_CHANGE_FETCH_INPUT\",\n                    \"apiEndPoint\":{\n                      \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                      \"type\":\"GET\",\n                      \"headers\":{\n                        \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                        \"Elements-Formula-Instance-Id\": instanceId\n                      },\n                      \"input\":{\n                        \"card\":\"subscription\"\n                      }\n                    }\n                  },\n                  \"dropDownItemsList\":[\n                    {\n                      \"disp\": \"Update existing deal\",\n                      \"value\": \"option2\",\n                      \"helptext\": \"Last Created Open deal will be updated in Pipedrive. <a href='' target='blank'>Learn More</a>\"\n                    },\n                    {\n                      \"disp\": \"Do Nothing\",\n                      \"value\": \"option3\"\n                    }\n                  ],\n                  \"defaultVal\": trigger.args.request.query['subDeleted'] || \"option3\"\n              },\n              {  \n                \"dispName\":\"... subscription is <b>paused</b>\",\n                \"req\":\"false\",\n                \"type\":\"DROPDOWN_DYNAMIC\",\n                \"id\":\"subPaused\",\n                \"isDynamic\":\"true\",\n                \"request\":{\n                    \"type\":\"ON_CHANGE_FETCH_INPUT\",\n                    \"apiEndPoint\":{\n                      \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                      \"type\":\"GET\",\n                      \"headers\":{\n                        \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                        \"Elements-Formula-Instance-Id\": instanceId\n                      },\n                      \"input\":{\n                        \"card\":\"subscription\"\n                      }\n                    }\n                  },\n                  \"dropDownItemsList\":[\n                    {\n                      \"disp\": \"Update existing deal\",\n                      \"value\": \"option2\",\n                      \"helptext\": \"Last Created Open deal will be updated in Pipedrive. <a href='' target='blank'>Learn More</a>\"\n                    },\n                    {\n                      \"disp\": \"Do Nothing\",\n                      \"value\": \"option3\"\n                    }\n                  ],\n                  \"defaultVal\": trigger.args.request.query['subPaused'] || \"option3\"\n              },\n              {  \n                \"dispName\":\"... subscription is <b>resumed</b>\",\n                \"req\":\"false\",\n                \"type\":\"DROPDOWN_DYNAMIC\",\n                \"id\":\"subResumed\",\n                \"isDynamic\":\"true\",\n                \"request\":{\n                    \"type\":\"ON_CHANGE_FETCH_INPUT\",\n                    \"apiEndPoint\":{\n                      \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                      \"type\":\"GET\",\n                      \"headers\":{\n                        \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                        \"Elements-Formula-Instance-Id\": instanceId\n                      },\n                      \"input\":{\n                        \"card\":\"subscription\"\n                      }\n                    }\n                  },\n                  \"dropDownItemsList\":[\n                    {\n                      \"disp\": \"Update existing deal\",\n                      \"value\": \"option2\",\n                      \"helptext\": \"Last Created Open deal will be updated in Pipedrive. <a href='' target='blank'>Learn More</a>\"\n                    },\n                    {\n                      \"disp\": \"Do Nothing\",\n                      \"value\": \"option3\"\n                    }\n                  ],\n                  \"defaultVal\": trigger.args.request.query['subResumed'] || \"option3\"\n              },\n              {  \n                \"dispName\":\"... subscription is <b>cancelled</b>\",\n                \"req\":\"false\",\n                \"type\":\"DROPDOWN_DYNAMIC\",\n                \"id\":\"subCancelled\",\n                \"isDynamic\":\"true\",\n                \"request\":{\n                    \"type\":\"ON_CHANGE_FETCH_INPUT\",\n                    \"apiEndPoint\":{\n                      \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                      \"type\":\"GET\",\n                      \"headers\":{\n                        \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                        \"Elements-Formula-Instance-Id\": instanceId\n                      },\n                      \"input\":{\n                        \"card\":\"subscription\"\n                      }\n                    }\n                  },\n                  \"dropDownItemsList\":[\n                    {\n                      \"disp\": \"Update existing deal\",\n                      \"value\": \"option2\",\n                      \"helptext\": \"Last Created Open deal will be updated in Pipedrive. <a href='' target='blank'>Learn More</a>\"\n                    },\n                    {\n                      \"disp\": \"Do Nothing\",\n                      \"value\": \"option3\"\n                    }\n                  ],\n                  \"defaultVal\": trigger.args.request.query['subCancelled'] || \"option3\"\n              },\n              {  \n                \"dispName\":\"... subscription is <b>reactivated</b>\",\n                \"req\":\"false\",\n                \"type\":\"DROPDOWN_DYNAMIC\",\n                \"id\":\"subReactivated\",\n                \"isSeperator\":true,\n                \"isDynamic\":\"true\",\n                \"request\":{\n                    \"type\":\"ON_CHANGE_FETCH_INPUT\",\n                    \"apiEndPoint\":{\n                      \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                      \"type\":\"GET\",\n                      \"headers\":{\n                        \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                        \"Elements-Formula-Instance-Id\": instanceId\n                      },\n                      \"input\":{\n                        \"card\":\"subscription\"\n                      }\n                    }\n                  },\n                  \"dropDownItemsList\":[\n                    {\n                      \"disp\": \"Create a deal\",\n                      \"value\": \"option1\"\n                    },\n                    {\n                      \"disp\": \"Update existing deal\",\n                      \"value\": \"option2\",\n                      \"helptext\": \"Last Created Open deal will be updated in Pipedrive. <a href='' target='blank'>Learn More</a>\"\n                    },\n                    {\n                      \"disp\": \"Do Nothing\",\n                      \"value\": \"option3\"\n                    }\n                  ],\n                  \"defaultVal\": trigger.args.request.query['subReactivated'] || \"option3\"\n              },\n              {  \n                \"dispName\":\"Choose how you'd like to <b>update deal value</b> in Pipedrive\",\n                \"req\":\"false\",\n                \"type\":\"DROPDOWN\",\n                \"id\":\"howToUpdateDealValue\",\n                \"allowedValues\":{\n                    \"option1\": \"Use Recurring Items Total\",\n                    \"option2\": \"Use invoice amount\",\n                    // \"option3\": \"Use Subscription MRR\",\n                    \"option4\": \"Don't Update Deal Value\",\n                },\n                  \"defaultVal\": trigger.args.request.query['howToUpdateDealValue'] || \"option2\"\n              },\n              {       \n              \"dispName\":\"Allow Chargebee to add notes to deals\",\n                \"desc\":\"Enable if you want Chargebee to add notes to deals when changes are made to deal stage or deal value. <a href=\\\"\\\" target=\\\"blank\\\">Learn more</a>\",\n                \"req\":\"false\",\n                \"type\":\"TOGGLE\",\n                \"id\":\"addNotesSubscription\",\n                \"defaultVal\": trigger.args.request.query['addNotesSubscription'] || false,\n                \"subCaption\":\"Example: \\\"Deal worth USD 99 created due to subscription (#12dfgh) creation in Chargebee\\\"\"\n              }\n            ]\n        },\n        \"id\" : \"testdynamic\",\n        \"isCardDone\": \"true\"\n      };\n\n    if((trigger.args.request.query['subCreated'] !== undefined) && (trigger.args.request.query['subCreated'] !== \"option3\")){\n        pipeline = {\n            \"dispName\":\"<p style='padding-left: 10px;'>- Choose the pipeline you'd like to add this deal to </p>\",\n            \"req\":\"false\",\n            \"id\":\"subCreatedPipeline\",\n            \"type\":\"DROPDOWN_DYNAMIC\",\n            \"dropDownItemsList\": pipelineList,\n            \"isDynamic\":\"true\",\n            \"request\":{\n                \"type\":\"ON_CHANGE_FETCH_INPUT\",\n                \"apiEndPoint\":{\n                    \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                    \"type\":\"GET\",\n                    \"headers\":{\n                        \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                        \"Elements-Formula-Instance-Id\": instanceId\n                    },\n                    \"input\":{\n                        \"card\":\"subscription\",\n                        \"selectedPipeline\" : \"subCreatedPipeline\"\n                    }\n                }\n            },\n            \"defaultVal\": trigger.args.request.query['subCreatedPipeline'] || \"1\"\n        };\n        stage = {\n            \"dispName\":\"<p style='padding-left: 10px;'>- Choose the stage you'd like to add this deal to\",\n            \"req\":\"false\",\n            \"type\":\"DROPDOWN_DYNAMIC\",\n            \"id\":\"subCreatedStage\",\n            \"request\":{\n                \"type\":\"ON_CHANGE_FETCH_INPUT\",\n                \"apiEndPoint\":{\n                    \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                    \"type\":\"GET\",\n                    \"headers\":{\n                        \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                        \"Elements-Formula-Instance-Id\": instanceId\n                    },\n                    \"input\":{\n                        // \"card\":\"subscription\",\n                        // \"isDynamicComponent\" : true\n                        \"id\": \"chargebee\"\n                    }\n                }\n            },\n            \"dropDownItemsList\": stagesList[(trigger.args.request.query['subCreatedPipeline']-1)] || stagesList[0],\n            \"defaultVal\": (trigger.args.request.query['subCreatedStage'] !== undefined) ? trigger.args.request.query['subCreatedStage'] : stagesList[(pipeline.defaultVal)-1][0]['value']\n        };\n        for(var i=0; i < subscriptionCard_body.card.params.length; i++){\n            if(subscriptionCard_body.card.params[i]['id'] === \"subCreated\"){\n                subscriptionCard_body.card.params.splice(i+1,0,pipeline);\n                subscriptionCard_body.card.params.splice(i+2,0,stage);\n                break;\n            }\n        }\n    }\n\n    if((trigger.args.request.query['subUpdated'] !== undefined) && (trigger.args.request.query['subUpdated'] !== \"option3\")){\n        pipeline = {\n            \"dispName\":\"<p style='padding-left: 10px;'>- Choose the pipeline you'd like to add this deal to </p>\",\n            \"req\":\"false\",\n            \"id\":\"subUpdatedPipeline\",\n            \"type\":\"DROPDOWN_DYNAMIC\",\n            \"dropDownItemsList\": pipelineList,\n            \"isDynamic\":\"true\",\n            \"request\":{\n                \"type\":\"ON_CHANGE_FETCH_INPUT\",\n                \"apiEndPoint\":{\n                    \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                    \"type\":\"GET\",\n                    \"headers\":{\n                        \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                        \"Elements-Formula-Instance-Id\": instanceId\n                    },\n                    \"input\":{\n                        \"card\":\"subscription\",\n                        \"selectedPipeline\" : \"subUpdatedPipeline\"\n                    }\n                }\n            },\n            \"defaultVal\": trigger.args.request.query['subUpdatedPipeline'] || \"1\"\n        };\n        stage = {\n            \"dispName\":\"<p style='padding-left: 10px;'>- Choose the stage you'd like to add this deal to\",\n            \"req\":\"false\",\n            \"type\":\"DROPDOWN_DYNAMIC\",\n            \"id\":\"subUpdatedStage\",\n            \"request\":{\n                \"type\":\"ON_CHANGE_FETCH_INPUT\",\n                \"apiEndPoint\":{\n                    \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                    \"type\":\"GET\",\n                    \"headers\":{\n                        \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                        \"Elements-Formula-Instance-Id\": instanceId\n                    },\n                    \"input\":{\n                        \"id\": \"chargebee\"\n                    }\n                }\n            },\n            \"dropDownItemsList\": stagesList[(trigger.args.request.query['subUpdatedPipeline']-1)] || stagesList[0],\n            \"defaultVal\": (trigger.args.request.query['subUpdatedStage'] !== undefined) ? trigger.args.request.query['subUpdatedStage'] : stagesList[(pipeline.defaultVal)-1][0]['value']\n        };\n        for(var i=0; i < subscriptionCard_body.card.params.length; i++){\n            if(subscriptionCard_body.card.params[i]['id'] === \"subUpdated\"){\n                subscriptionCard_body.card.params.splice(i+1,0,pipeline);\n                subscriptionCard_body.card.params.splice(i+2,0,stage);\n                break;\n            }\n        }\n    }\n\n    if((trigger.args.request.query['subDeleted'] !== undefined) && (trigger.args.request.query['subDeleted'] !== \"option3\")){\n        pipeline = {\n            \"dispName\":\"<p style='padding-left: 10px;'>- Choose the pipeline you'd like to add this deal to </p>\",\n            \"req\":\"false\",\n            \"id\":\"subDeletedPipeline\",\n            \"type\":\"DROPDOWN_DYNAMIC\",\n            \"dropDownItemsList\": pipelineList,\n            \"isDynamic\":\"true\",\n            \"request\":{\n                \"type\":\"ON_CHANGE_FETCH_INPUT\",\n                \"apiEndPoint\":{\n                    \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                    \"type\":\"GET\",\n                    \"headers\":{\n                        \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                        \"Elements-Formula-Instance-Id\": instanceId\n                    },\n                    \"input\":{\n                        \"card\":\"subscription\",\n                        \"selectedPipeline\" : \"subDeletedPipeline\"\n                    }\n                }\n            },\n            \"defaultVal\": trigger.args.request.query['subDeletedPipeline'] || \"1\"\n        };\n        stage = {\n            \"dispName\":\"<p style='padding-left: 10px;'>- Choose the stage you'd like to add this deal to\",\n            \"req\":\"false\",\n            \"type\":\"DROPDOWN_DYNAMIC\",\n            \"id\":\"subDeletedStage\",\n            \"request\":{\n                \"type\":\"ON_CHANGE_FETCH_INPUT\",\n                \"apiEndPoint\":{\n                    \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                    \"type\":\"GET\",\n                    \"headers\":{\n                        \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                        \"Elements-Formula-Instance-Id\": instanceId\n                    },\n                    \"input\":{\n                        \"id\": \"chargebee\"\n                    }\n                }\n            },\n            \"dropDownItemsList\": stagesList[(trigger.args.request.query['subDeletedPipeline']-1)] || stagesList[0],\n            \"defaultVal\": (trigger.args.request.query['subDeletedStage'] !== undefined) ? trigger.args.request.query['subDeletedStage'] : stagesList[(pipeline.defaultVal)-1][0]['value']\n        };\n        for(var i=0; i < subscriptionCard_body.card.params.length; i++){\n            if(subscriptionCard_body.card.params[i]['id'] === \"subDeleted\"){\n                subscriptionCard_body.card.params.splice(i+1,0,pipeline);\n                subscriptionCard_body.card.params.splice(i+2,0,stage);\n                break;\n            }\n        }\n    }\n\n    if((trigger.args.request.query['subPaused'] !== undefined) && (trigger.args.request.query['subPaused'] !== \"option3\")){\n        pipeline = {\n            \"dispName\":\"<p style='padding-left: 10px;'>- Choose the pipeline you'd like to add this deal to </p>\",\n            \"req\":\"false\",\n            \"id\":\"subPausedPipeline\",\n            \"type\":\"DROPDOWN_DYNAMIC\",\n            \"dropDownItemsList\": pipelineList,\n            \"isDynamic\":\"true\",\n            \"request\":{\n                \"type\":\"ON_CHANGE_FETCH_INPUT\",\n                \"apiEndPoint\":{\n                    \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                    \"type\":\"GET\",\n                    \"headers\":{\n                        \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                        \"Elements-Formula-Instance-Id\": instanceId\n                    },\n                    \"input\":{\n                        \"card\":\"subscription\",\n                        \"selectedPipeline\" : \"subPausedPipeline\"\n                    }\n                }\n            },\n            \"defaultVal\": trigger.args.request.query['subPausedPipeline'] || \"1\"\n        };\n        stage = {\n            \"dispName\":\"<p style='padding-left: 10px;'>- Choose the stage you'd like to add this deal to\",\n            \"req\":\"false\",\n            \"type\":\"DROPDOWN_DYNAMIC\",\n            \"id\":\"subPausedStage\",\n            \"request\":{\n                \"type\":\"ON_CHANGE_FETCH_INPUT\",\n                \"apiEndPoint\":{\n                    \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                    \"type\":\"GET\",\n                    \"headers\":{\n                        \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                        \"Elements-Formula-Instance-Id\": instanceId\n                    },\n                    \"input\":{\n                        \"id\": \"chargebee\"\n                    }\n                }\n            },\n            \"dropDownItemsList\": stagesList[(trigger.args.request.query['subPausedPipeline']-1)] || stagesList[0],\n            \"defaultVal\": (trigger.args.request.query['subPausedStage'] !== undefined) ? trigger.args.request.query['subPausedStage'] : stagesList[(pipeline.defaultVal)-1][0]['value']\n        };\n        for(var i=0; i < subscriptionCard_body.card.params.length; i++){\n            if(subscriptionCard_body.card.params[i]['id'] === \"subPaused\"){\n                subscriptionCard_body.card.params.splice(i+1,0,pipeline);\n                subscriptionCard_body.card.params.splice(i+2,0,stage);\n                break;\n            }\n        }\n    }\n\n    if((trigger.args.request.query['subResumed'] !== undefined) && (trigger.args.request.query['subResumed'] !== \"option3\")){\n        pipeline = {\n            \"dispName\":\"<p style='padding-left: 10px;'>- Choose the pipeline you'd like to add this deal to </p>\",\n            \"req\":\"false\",\n            \"id\":\"subResumedPipeline\",\n            \"type\":\"DROPDOWN_DYNAMIC\",\n            \"dropDownItemsList\": pipelineList,\n            \"isDynamic\":\"true\",\n            \"request\":{\n                \"type\":\"ON_CHANGE_FETCH_INPUT\",\n                \"apiEndPoint\":{\n                    \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                    \"type\":\"GET\",\n                    \"headers\":{\n                        \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                        \"Elements-Formula-Instance-Id\": instanceId\n                    },\n                    \"input\":{\n                        \"card\":\"subscription\",\n                        \"selectedPipeline\" : \"subResumedPipeline\"\n                    }\n                }\n            },\n            \"defaultVal\": trigger.args.request.query['subResumedPipeline'] || \"1\"\n        };\n        stage = {\n            \"dispName\":\"<p style='padding-left: 10px;'>- Choose the stage you'd like to add this deal to\",\n            \"req\":\"false\",\n            \"type\":\"DROPDOWN_DYNAMIC\",\n            \"id\":\"subResumedStage\",\n            \"request\":{\n                \"type\":\"ON_CHANGE_FETCH_INPUT\",\n                \"apiEndPoint\":{\n                    \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                    \"type\":\"GET\",\n                    \"headers\":{\n                        \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                        \"Elements-Formula-Instance-Id\": instanceId\n                    },\n                    \"input\":{\n                        \"id\": \"chargebee\"\n                    }\n                }\n            },\n            \"dropDownItemsList\": stagesList[(trigger.args.request.query['subResumedPipeline']-1)] || stagesList[0],\n            \"defaultVal\": (trigger.args.request.query['subResumedStage'] !== undefined) ? trigger.args.request.query['subResumedStage'] : stagesList[(pipeline.defaultVal)-1][0]['value']\n        };\n        for(var i=0; i < subscriptionCard_body.card.params.length; i++){\n            if(subscriptionCard_body.card.params[i]['id'] === \"subResumed\"){\n                subscriptionCard_body.card.params.splice(i+1,0,pipeline);\n                subscriptionCard_body.card.params.splice(i+2,0,stage);\n                break;\n            }\n        }\n    }\n\n    if((trigger.args.request.query['subCancelled'] !== undefined) && (trigger.args.request.query['subCancelled'] !== \"option3\")){\n        pipeline = {\n            \"dispName\":\"<p style='padding-left: 10px;'>- Choose the pipeline you'd like to add this deal to </p>\",\n            \"req\":\"false\",\n            \"id\":\"subCancelledPipeline\",\n            \"type\":\"DROPDOWN_DYNAMIC\",\n            \"dropDownItemsList\": pipelineList,\n            \"isDynamic\":\"true\",\n            \"request\":{\n                \"type\":\"ON_CHANGE_FETCH_INPUT\",\n                \"apiEndPoint\":{\n                    \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                    \"type\":\"GET\",\n                    \"headers\":{\n                        \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                        \"Elements-Formula-Instance-Id\": instanceId\n                    },\n                    \"input\":{\n                        \"card\":\"subscription\",\n                        \"selectedPipeline\" : \"subCancelledPipeline\"\n                    }\n                }\n            },\n            \"defaultVal\": trigger.args.request.query['subCancelledPipeline'] || \"1\"\n        };\n        stage = {\n            \"dispName\":\"<p style='padding-left: 10px;'>- Choose the stage you'd like to add this deal to\",\n            \"req\":\"false\",\n            \"type\":\"DROPDOWN_DYNAMIC\",\n            \"id\":\"subCancelledStage\",\n            \"request\":{\n                \"type\":\"ON_CHANGE_FETCH_INPUT\",\n                \"apiEndPoint\":{\n                    \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                    \"type\":\"GET\",\n                    \"headers\":{\n                        \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                        \"Elements-Formula-Instance-Id\": instanceId\n                    },\n                    \"input\":{\n                        \"id\": \"chargebee\"\n                    }\n                }\n            },\n            \"dropDownItemsList\": stagesList[(trigger.args.request.query['subCancelledPipeline']-1)] || stagesList[0],\n            \"defaultVal\": (trigger.args.request.query['subCancelledStage'] !== undefined) ? trigger.args.request.query['subCancelledStage'] : stagesList[(pipeline.defaultVal)-1][0]['value']\n        };\n        for(var i=0; i < subscriptionCard_body.card.params.length; i++){\n            if(subscriptionCard_body.card.params[i]['id'] === \"subCancelled\"){\n                subscriptionCard_body.card.params.splice(i+1,0,pipeline);\n                subscriptionCard_body.card.params.splice(i+2,0,stage);\n                break;\n            }\n        }\n    }\n\n    if((trigger.args.request.query['subReactivated'] !== undefined) && (trigger.args.request.query['subReactivated'] !== \"option3\")){\n        pipeline = {\n            \"dispName\":\"<p style='padding-left: 10px;'>- Choose the pipeline you'd like to add this deal to </p>\",\n            \"req\":\"false\",\n            \"id\":\"subReactivatedPipeline\",\n            \"type\":\"DROPDOWN_DYNAMIC\",\n            \"dropDownItemsList\": pipelineList,\n            \"isDynamic\":\"true\",\n            \"request\":{\n                \"type\":\"ON_CHANGE_FETCH_INPUT\",\n                \"apiEndPoint\":{\n                    \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                    \"type\":\"GET\",\n                    \"headers\":{\n                        \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                        \"Elements-Formula-Instance-Id\": instanceId\n                    },\n                    \"input\":{\n                        \"card\":\"subscription\",\n                        \"selectedPipeline\" : \"subReactivatedPipeline\"\n                    }\n                }\n            },\n            \"defaultVal\": trigger.args.request.query['subReactivatedPipeline'] || \"1\"\n        };\n        stage = {\n            \"dispName\":\"<p style='padding-left: 10px;'>- Choose the stage you'd like to add this deal to\",\n            \"req\":\"false\",\n            \"type\":\"DROPDOWN_DYNAMIC\",\n            \"isSeperator\":true,\n            \"id\":\"subReactivatedStage\",\n            \"request\":{\n                \"type\":\"ON_CHANGE_FETCH_INPUT\",\n                \"apiEndPoint\":{\n                    \"apiUrl\":cloudElementsUrl+\"/pipedrive/getStages\",\n                    \"type\":\"GET\",\n                    \"headers\":{\n                        \"Authorization\":\"User XNzP5miZ8LjANZarWA0np2LmNeRkUanHScUEQmQHwDs=, Organization c9584f9cc4a4c8391568438a9a3041a2\",\n                        \"Elements-Formula-Instance-Id\": instanceId\n                    },\n                    \"input\":{\n                        \"id\": \"chargebee\"\n                    }\n                }\n            },\n            \"dropDownItemsList\": stagesList[(trigger.args.request.query['subReactivatedPipeline']-1)] || stagesList[0],\n            \"defaultVal\": (trigger.args.request.query['subReactivatedStage'] !== undefined) ? trigger.args.request.query['subReactivatedStage'] : stagesList[(pipeline.defaultVal)-1][0]['value']\n        };\n        for(var i=0; i < subscriptionCard_body.card.params.length; i++){\n            if(subscriptionCard_body.card.params[i]['id'] === \"subReactivated\"){\n                subscriptionCard_body.card.params[i]['isSeperator'] = undefined;\n                subscriptionCard_body.card.params.splice(i+1,0,pipeline);\n                subscriptionCard_body.card.params.splice(i+2,0,stage);\n                break;\n            }\n        }\n    }\n    \n  // //IF ALL STEPS ARE DONOTHING\n  if((trigger.args.request.query['subCreated'] === \"option3\") && (trigger.args.request.query['subUpdated'] === \"option3\") && (trigger.args.request.query['subDeleted'] === \"option3\") && (trigger.args.request.query['subPaused'] === \"option3\") && (trigger.args.request.query['subResumed'] === \"option3\") && (trigger.args.request.query['subCancelled'] === \"option3\") && (trigger.args.request.query['subReactivated'] === \"option3\")){\n    for(var i=0; i < subscriptionCard_body.card.params.length; i++){\n      if(subscriptionCard_body.card.params[i]['id'] === \"howToUpdateDealValue\"){\n        subscriptionCard_body.card.params.splice(i);\n        if(subscriptionCard_body.card.params[i-1]['isSeperator'] !== undefined){\n          subscriptionCard_body.card.params[i-1]['isSeperator'] = undefined;\n        }\n      }\n    }\n  }\n  //    \n   \n  card.cards.push(subscriptionCard_body);\n    \n  \n}\n\n\n\ndone({\n  result: card\n});"}},{"id":230839,"onSuccess":["getPipelinesFromPipedrive_params"],"onFailure":[],"name":"test","type":"filter","properties":{"body":"done(false);"}},{"id":223116,"onSuccess":[],"onFailure":[],"name":"triggerRefreshToken","type":"script","properties":{"body":"let instanceId = steps.getTpConfig.response.body.third_party_configuration.config_json.cloudElements.formulas.formula_GetRefreshToken.instance;\n//Instance id of getAccessTokenFormula formula\n\nlet triggerParams = {\n  url: \"/formulas/instances/\"+instanceId+\"/executions\",\n  body: {\n    apiKey: steps.InputParams.params.input.apiKey,\n    siteName: steps.InputParams.params.input.siteName,\n    siteDomain: steps.InputParams.params.input.siteDomain,\n    integration_name: steps.InputParams.params.input.integration_name,\n    password: steps.InputParams.params.input.password\n  }\n};\n\ndone({\n  triggerParams: triggerParams,\n  instanceId: instanceId\n});\n\n"}}],"triggers":[{"id":26048,"onSuccess":["EnvProps"],"onFailure":[],"type":"manual","async":true,"name":"trigger","properties":{}}],"method":"GET","uri":"/pipedrive/getStages","engine":"v1","active":true,"debugLoggingEnabled":true,"singleThreaded":false,"api":"GET /pipedrive/getStages","configuration":[]}