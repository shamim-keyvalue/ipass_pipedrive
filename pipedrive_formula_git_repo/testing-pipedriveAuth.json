{"id":29423,"name":"testing-pipedriveAuth","userId":27893,"accountId":24428,"createdDate":"2019-09-05T07:11:21Z","steps":[{"id":216396,"onSuccess":[],"onFailure":[],"name":"SendOptions","type":"script","properties":{"body":"let res;\n\nif(trigger.args.request.query['error'] !== undefined){\n  res = {\n      \"cards\": [{\n          \"id\": \"check2\",\n          \"card\": {\n              \"type\": \"ACTION\",\n              \"heading\": \"Error:  Authentication Failed\",\n              \"listContent\": [\n                  trigger.args.request.query['error']\n              ],\n              \"icon\": \"WARNING\"\n          }\n      }]\n  };\n  done({\n    statusCode: 401,\n    res: res\n  });\n}\n\n\nlet code = trigger.args.request.query['code'];\nlet state = trigger.args.request.query['state'];\nlet siteName = trigger.args.request.query['cb-site-name'];\nlet redirect_uri = trigger.args.request.query['redirect_uri'];\nlet client_info = JSON.parse(trigger.args.request.query['client_info']);\n\nlet client_id = client_info.client_id;\nlet client_secret = client_info.client_secret;\n\nlet cid = CE.b64(client_id + \":\" + client_secret);\n\n// let cid = CE.b64('833887fd6283fad0:9f9e7f0c0b05e51c894d2718b81def12b22d0f31');\n\n\nres = {\n    url: 'https://oauth.pipedrive.com/oauth/token',\n    method:\"POST\",\n    headers: {\n      'Accept': 'application/json',\n      'Content-Type' : 'application/x-www-form-urlencoded',\n      'Authorization': 'Basic ' + cid\n    },\n    form:{\n      'grant_type' : 'authorization_code',\n      'code' : code,\n      'state': state,\n      'redirect_uri' : redirect_uri\n    },\n    \"redirect_uri\": redirect_uri,\n    \"site_name\": state,\n    urlParams:{}\n  };\n\ndone({\n  statusCode: 200,\n  result: res\n});\n\n\n// res = {\n//     url: 'https://oauth.pipedrive.com/oauth/token',\n//     method:\"POST\",\n//     headers: {\n//       'Accept': 'application/json',\n//       'Content-Type' : 'application/x-www-form-urlencoded',\n//       'Authorization': 'Basic ' + cid\n//     },\n//     form:{\n//       'grant_type' : 'authorization_code',\n//       'code' : code,\n//       'state': state\n//     },\n//     \"redirect_uri\": \"https://app.localcb.in:9443/integrations/pipedrive/oauth_callback?\",\n//     \"site_name\": state,\n//     urlParams:{}\n//   };\n\n// done({\n//   statusCode: 200,\n//   result: res\n// });\n  "}}],"triggers":[{"id":26050,"onSuccess":["SendOptions"],"onFailure":[],"type":"manual","async":true,"name":"trigger","properties":{}}],"method":"GET","uri":"/pipedrive/auth","engine":"v1","active":true,"debugLoggingEnabled":true,"singleThreaded":false,"api":"GET /pipedrive/auth","configuration":[]}